{"version":3,"sources":["components/LoginPage/video-logo.png","components/VideoProvider/useSelectedParticipant/useSelectedParticipant.tsx","utils.ts","hooks/useLocalVideoToggle/useLocalVideoToggle.tsx","components/VideoProvider/AttachVisibilityHandler/AttachVisibilityHandler.tsx","components/VideoProvider/useLocalTracks/useLocalTracks.ts","components/VideoProvider/useRoom/useRoom.tsx","components/VideoProvider/index.tsx","components/VideoProvider/useHandleRoomDisconnectionErrors/useHandleRoomDisconnectionErrors.ts","components/VideoProvider/useHandleTrackPublicationFailed/useHandleTrackPublicationFailed.ts","components/VideoProvider/useHandleOnDisconnect/useHandleOnDisconnect.ts","hooks/useVideoContext/useVideoContext.ts","components/Controls/EndCallButton/EndCallButton.tsx","hooks/useIsTrackEnabled/useIsTrackEnabled.tsx","components/Controls/ToggleAudioButton/ToggleAudioButton.tsx","hooks/useLocalAudioToggle/useLocalAudioToggle.tsx","components/Controls/ToggleVideoButton/ToggleVideoButton.tsx","hooks/useScreenShareParticipant/useScreenShareParticipant.tsx","components/Controls/ToogleScreenShareButton/ToggleScreenShareButton.tsx","hooks/useScreenShareToggle/useScreenShareToggle.tsx","hooks/useRoomState/useRoomState.tsx","components/Controls/Controls.tsx","components/Controls/useIsUserActive/useIsUserActive.ts","components/VideoTrack/VideoTrack.tsx","components/LocalVideoPreview/LocalVideoPreview.tsx","components/MenuBar/ToggleFullScreenButton/ToggleFullScreenButton.tsx","hooks/useFullScreenToggle/useFullScreenToggle.tsx","components/MenuBar/AboutDialog/AboutDialog.tsx","components/MenuBar/UserAvatar/UserAvatar.tsx","state/useFirebaseAuth/useFirebaseAuth.ts","state/usePasscodeAuth/usePasscodeAuth.ts","state/index.tsx","components/MenuBar/Menu/Menu.tsx","components/MenuBar/FlipCameraButton/FlipCameraButton.tsx","components/AudioLevelIndicator/AudioLevelIndicator.tsx","components/MenuBar/DeviceSelector/LocalAudioLevelIndicator/LocalAudioLevelIndicator.tsx","components/MenuBar/DeviceSelector/deviceHooks/deviceHooks.tsx","components/MenuBar/DeviceSelector/AudioInputList/AudioInputList.tsx","components/MenuBar/DeviceSelector/AudioOutputList/AudioOutputList.tsx","components/MenuBar/DeviceSelector/VideoInputList/VideoInputList.tsx","components/MenuBar/DeviceSelector/DeviceSelector.tsx","components/MenuBar/MenuBar.tsx","components/ReconnectingNotification/ReconnectingNotification.tsx","components/BandwidthWarning/BandwidthWarning.tsx","components/NewtorkQualityLevel/NetworkQualityLevel.tsx","components/ParticipantInfo/ParticipantConnectionIndicator/ParticipantConnectionIndicator.tsx","hooks/useParticipantIsReconnecting/useParticipantIsReconnecting.ts","components/ParticipantInfo/PinIcon/PinIcon.tsx","hooks/usePublications/usePublications.tsx","hooks/useIsTrackSwitchedOff/useIsTrackSwitchedOff.tsx","hooks/useTrack/useTrack.tsx","components/ParticipantInfo/ParticipantInfo.tsx","hooks/useParticipantNetworkQualityLevel/useParticipantNetworkQualityLevel.tsx","components/AudioTrack/AudioTrack.tsx","components/Publication/Publication.tsx","components/ParticipantTracks/ParticipantTracks.tsx","components/Participant/Participant.tsx","hooks/useDominantSpeaker/useDominantSpeaker.tsx","hooks/useParticipants/useParticipants.tsx","components/ParticipantStrip/ParticipantStrip.tsx","components/MainParticipantInfo/MainParticipantInfo.tsx","components/MainParticipant/MainParticipant.tsx","hooks/useMainSpeaker/useMainSpeaker.tsx","components/Room/Room.tsx","App.tsx","hooks/useHeight/useHeight.ts","components/ErrorDialog/ErrorDialog.tsx","components/ErrorDialog/enhanceMessage.ts","components/LoginPage/google-logo.svg","components/LoginPage/twilio-logo.svg","components/LoginPage/LoginPage.tsx","components/PrivateRoute/PrivateRoute.tsx","theme.ts","index.tsx"],"names":["module","exports","selectedParticipantContext","createContext","useSelectedParticipant","useContext","SelectedParticipantProvider","room","children","useState","selectedParticipant","_setSelectedParticipant","useEffect","onDisconnect","on","off","Provider","value","participant","prevParticipant","isMobile","navigator","userAgent","test","ensureMediaPermissions","mediaDevices","enumerateDevices","then","devices","every","device","deviceId","label","shouldAskForMediaPermissions","getUserMedia","audio","video","mediaStream","getTracks","forEach","track","stop","useLocalVideoToggle","useVideoContext","localParticipant","localTracks","getLocalVideoTrack","videoTrack","find","name","includes","toggleVideoEnabled","useCallback","localTrackPublication","unpublishTrack","emit","publishTrack","priority","AttachVisibilityHandler","isVideoEnabled","shouldRepublishVideoOnForeground","useRef","handleVisibilityChange","document","visibilityState","current","addEventListener","removeEventListener","useLocalTracks","setTrack","getLocalAudioTrack","options","exact","Video","createLocalAudioTrack","newTrack","handleStopped","undefined","useLocalAudioTrack","audioTrack","newOptions","frameRate","height","width","Date","now","createLocalVideoTrack","useLocalVideoTrack","filter","window","TwilioVideo","VideoContext","VideoProvider","onError","onErrorCallback","error","console","log","message","EventEmitter","setRoom","isConnecting","setIsConnecting","localTracksRef","connect","token","tracks","newRoom","disconnect","once","setTimeout","twilioRoom","kind","useRoom","onDisconnected","useHandleRoomDisconnectionErrors","useHandleTrackPublicationFailed","useHandleOnDisconnect","context","Error","useStyles","makeStyles","theme","createStyles","fab","margin","spacing","EndCallButton","classes","Tooltip","title","onClick","placement","PopperProps","disablePortal","Fab","className","color","useIsTrackEnabled","isEnabled","setIsEnabled","setEnabled","setDisabled","ToggleAudioButton","props","disable","enable","useLocalAudioToggle","isAudioEnabled","toggleAudioEnabled","disabled","data-cy-audio-toggle","ToggleVideoButton","useScreenShareParticipant","screenShareParticipant","setScreenShareParticipant","state","updateScreenShareParticipant","Array","from","participants","values","concat","trackName","backgroundColor","ToggleScreenShareButton","isSharing","setIsSharing","stopScreenShareRef","shareScreen","getDisplayMedia","stream","trackPublication","onended","catch","toggleScreenShare","useScreenShareToggle","isScreenShared","disableScreenShareButton","isScreenShareSupported","isDisabled","tooltipMessage","style","cursor","useRoomState","setState","setRoomState","container","display","position","right","transform","bottom","zIndex","transition","opacity","visibility","maxWidth","breakpoints","down","sidebarMobileHeight","Controls","roomState","isReconnecting","showControls","isUserActive","setIsUserActive","timeoutIDRef","handleUserActivity","throttle","clearTimeout","timeoutID","useIsUserActive","clsx","styled","maxHeight","objectFit","VideoTrack","isLocal","ref","el","muted","setPriority","attach","detach","isFrontFacing","mediaStreamTrack","getSettings","facingMode","LocalVideoPreview","ToggleFullscreenButton","fscreen","fullscreenElement","isFullScreen","setIsFullScreen","onFullScreenChange","toggleFullScreen","exitFullscreen","requestFullscreen","documentElement","useFullScreenToggle","fullscreenEnabled","IconButton","aria-label","AboutDialog","open","onClose","Dialog","fullWidth","DialogTitle","DialogContent","DialogContentText","String","isSupported","version","appVersion","process","REACT_APP_GIT_TAG","REACT_APP_GIT_COMMIT","DialogActions","Button","autoFocus","red","UserAvatar","user","displayName","photoURL","Avatar","src","split","map","text","join","toUpperCase","firebaseConfig","apiKey","REACT_APP_FIREBASE_API_KEY","authDomain","REACT_APP_FIREBASE_AUTH_DOMAIN","databaseURL","REACT_APP_FIREBASE_DATABASE_URL","storageBucket","REACT_APP_FIREBASE_STORAGE_BUCKET","messagingSenderId","REACT_APP_FIREBASE_MESSAGING_SENDER_ID","fetchToken","passcode","fetch","method","headers","body","JSON","stringify","user_identity","room_name","verifyPasscode","res","a","json","jsonResponse","status","isValid","ok","getErrorMessage","usePasscodeAuth","history","useHistory","setUser","isAuthReady","setIsAuthReady","getToken","errorMessage","statusText","match","location","search","sessionStorage","getItem","getPasscode","verification","setItem","replace","pathname","signIn","signOut","removeItem","Promise","resolve","StateContext","AppStateProvider","setError","isFetching","setIsFetching","activeSinkId","setActiveSinkId","contextValue","REACT_APP_SET_AUTH","identity","roomName","Headers","getIdToken","idToken","set","endpoint","REACT_APP_TOKEN_ENDPOINT","params","URLSearchParams","firebase","onAuthStateChanged","provider","GoogleAuthProvider","addScope","signInWithPopup","useFirebaseAuth","err","reject","useAppState","Menu","aboutOpen","setAboutOpen","menuOpen","setMenuOpen","anchorRef","handleSignOut","anchorEl","MenuItem","FlipCameraButton","supportsFacingMode","setSupportsFacingMode","Boolean","toggleFacingMode","newFacingMode","newVideoTrack","audioContext","clipId","AudioContext","webkitAudioContext","initializeAnalyser","audioSource","createMediaStreamSource","analyser","createAnalyser","smoothingTimeConstant","fftSize","React","memo","size","background","SIZE","mediaStreamRef","isTrackEnabled","SVGClipElement","MediaStream","clone","reinitializeAnalyser","sampleArray","Uint8Array","frequencyBinCount","timer","interval","getByteFrequencyData","length","i","volume","Math","min","max","log10","setAttribute","clipPathId","focusable","viewBox","aria-hidden","id","x","y","fill","d","clipPath","data-cy-audio-mute-icon","LocalAudioLevelIndicator","useDevices","setDevices","getDevices","alignItems","justifyContent","AudioInputList","audioInputDevices","localAudioTrack","localAudioInputDeviceId","FormControl","Typography","variant","Select","onChange","e","newDeviceId","target","key","AudioOutputList","audioOutputDevices","activeOutputLabel","preview","VideoInputList","videoInputDevices","localVideoTrack","localVideoInputDeviceId","listSection","button","float","paper","DeviceSelector","isOpen","setIsOpen","data-cy-device-select","palette","default","toolbar","padding","rightButtonContainer","marginLeft","form","flexWrap","up","textField","marginRight","loadingSpinner","minWidth","fontWeight","joinButton","MenuBar","URLRoomName","useParams","setName","setRoomName","AppBar","Toolbar","onSubmit","event","preventDefault","origin","replaceState","encodeURI","TextField","type","CircularProgress","snackbar","icon","ReconnectingNotification","Snackbar","anchorOrigin","vertical","horizontal","SnackbarContent","BandwidthWarningContainer","flexDirection","Warning","textAlign","BandwidthWarning","fontSize","Container","border","boxSizing","borderRight","NetworkQualityLevel","qualityLevel","level","indicator","borderRadius","ParticipantConnectionIndicator","setIsReconnecting","handleReconnecting","handleReconnected","useParticipantIsReconnecting","PinIcon","SvgIcon","usePublications","publications","setPublications","publicationAdded","publication","prevPublications","publicationRemoved","p","useIsTrackSwitchedOff","isSwitchedOff","setIsSwitchedOff","handleSwitchedOff","handleSwitchedOn","useTrack","removeTrack","sidebarWidth","overflow","stroke","strokeWidth","isVideoSwitchedOff","infoContainer","hideVideo","infoRow","ParticipantInfo","isSelected","audioPublication","videoPublication","networkQualityLevel","setNetworkQualityLevel","handleNewtorkQualityLevelChange","newNetworkQualityLevel","useParticipantNetworkQualityLevel","isScreenShareEnabled","data-cy-participant","AudioTrack","audioEl","appendChild","remove","setSinkId","Publication","disableAudio","videoPriority","ParticipantTracks","filteredPublications","enableScreenShare","some","Participant","useDominantSpeaker","dominantSpeaker","setDominantSpeaker","handleDominantSpeakerChanged","newDominantSpeaker","handleParticipantDisconnected","prevDominantSpeaker","useParticipants","setParticipants","prevParticipants","participantConnected","participantDisconnected","overflowY","overflowX","ScrollContainer","ParticipantStrip","setSelectedParticipant","sid","gridArea","MainParticipantInfo","screenSharePublication","data-cy-main-participant","MainParticipant","mainParticipant","useMainSpeaker","gridTemplateColumns","gridTemplateAreas","gridTemplateRows","gridGap","Room","Main","App","innerHeight","visualViewport","scale","setHeight","onResize","useHeight","ErrorDialog","dismissError","code","enhancedMessage","enhanceMessage","_extends","Object","assign","arguments","source","prototype","hasOwnProperty","call","apply","this","_objectWithoutProperties","excluded","sourceKeys","keys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","createElement","_ref4","filterUnits","dx","dy","in","result","stdDeviation","rx","_ref5","fillRule","_ref","svgRef","ForwardRef","forwardRef","twilioLogo","videoLogo","marginTop","textTransform","createMuiTheme","LoginPage","useLocation","setPasscode","authError","setAuthError","isAuthEnabled","login","ThemeProvider","Grid","justify","Paper","elevation","alt","startIcon","direction","PrivateRoute","rest","renderChildren","render","to","primary","main","connectionOptions","bandwidthProfile","mode","dominantSpeakerPriority","renderDimensions","high","standard","low","networkQuality","local","remote","maxAudioBitrate","preferredVideoCodecs","codec","simulcast","maxSubscriptionBitrate","VideoApp","ReactDOM","CssBaseline","path","getElementById"],"mappings":"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","file":"static/js/main.ac5190db.chunk.js","sourcesContent":["module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZIAAAEyCAYAAADQnlYUAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFdElEQVR42u3dwW3DUAxEQSnI2a2oCxXtLtyKGlB68BrZMH+mAoGH/8CLuF/HeW8AC3u8nrspvO/LCAAQEgAqruO8hQSAtyNiIwEgioiQABBFREgAiCIiJABEERESAKKICAkAUUSEBIAoIkICQBQRIQEgioiQABBFREgAiCIiJABEERESAKKICAkAW3rg8PuTH+PKGDDl8eNzc7SRAIiIkADQ2+iEBEBEhASATkSEBEBEhASAXkSEBEBEhASAXkSEBEBEhASAXkSEBEBEhASAXkSEBEBEhASA7t+QhQRARIQEQESEBICBERESABEREgARERIAhkZESABEREgARERIABgaESEBEBEhARARIQFgaESEBEBEhARARIQEgKERERKARSPyeD13IQEQkXpEhARARIQEQER6ERESABEREgAR6UVESABEREgARKQXESEBEBEhARCRXkSEBEBEhARARHoRERIAERESABHpRURIAERESABEREgARGRoRIQEQESEBEBEhARARIZGREgARERIAERESABEZGhEhARARIQEQESEBEBEhkZESABEREgARERIAERkaESEBEBEhARARIQEQESEBEBEVoyIkACIiJAATPLfIiIkACIiJAAiIiQAIiIkAKwYESEBEBEhARARIQEQESEBYMWICAmAiAgJgIgICYCICAmAiAgJACIiJAAiIiQAIiIkACIiJACIiJAAiIiQAIiIkACIiJAAiAhCAiAiQgIgIkICICJCAiAiCAmAiAgJgIgICYCICAmAiAgJgIggJAAiIiQAIiIkACIiJAAigpAAiIiQAIiIkACIiJAAiAhCAogIQgIgIkICICJCAiAiCAkgIggJgIj8Fd9GAAgINhIAhAQAIQFASABASAAQEgCEBAAhAQAhAUBIABASAIQEAIQEACEBQEgAEBIAEBIAhAQAIQFASAAQEgAQEgCEBAAhAUBIAEBIABASAIQEACEBACEBQEgAEBIAhAQAhAQAIQFASAAQEgCEBACEBAAhAUBIABASABASAIQEACEBQEgAQEgAEBIAhAQAIQEAIQFASAAQEoDQdZz3dZy3SQgJQBwUUxASADEREgAxERIAMUFIADEREyEBEBMhARATIQEQE4QEQEyEBEBMhARATIQEQEwQEgAxERIAMRESADEREgAxQUgAxERIAMRESADEREgAxERIABATIQEQEyEBEBMhARATIQFATIQEQEyEBEBMhARATIQEADEREgAxERIAMRESADEREgDEREgAxERIAMRESADEREgAWDsmQgIgJkICICZCAiAmQgLAijEREgAxERIAMRESADEREgBWjImQAGzb9ng9dzEREgAxERIAMRESADFZKiZCAiAmQgIgJkICICZDYyIkAGIiJABiIiQAYjI0JkICICZCAiAmQgIgJkNjIiQAYiIkAGIiJABiMjQmQgIgJkICICZCAiAmQ2MiJABiIiQAYtKLiZAAiImQAIhJLyZCAiAmQgIgJr2YCAmAmAgJgJj0YiIkAGIiJABi0ouJkACIiZAAiEkvJkICICZCAiAmvZgICcCiMRESADEREgDmx0RIAMRESADEREgAGBoTIQEQEyEBEBMhAWBoTIQEQEyEBEBMhASAoTEREgAxERIAMRESAIbGREgAxERIAOjFREgAxERIAOjFREgAxERIAOjFREgAxERIAOjFREgAxERIAOjFREgAxERIAOjFREgAxERIAOjFZL+O8zZOwKP6926h/5a0AzYSABGNIiokAEQxERIAopgICQBRTIQEgCgmQgJAFBMhASCKiZAAEMVESACIYiIkAEQxERIAopgICQBRTIQEgCgmQgJAFBMhASCKiZAAEMVESACI/ACDMI238rqCJQAAAABJRU5ErkJggg==\"","import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { Participant, Room } from 'twilio-video';\r\n\r\ntype selectedParticipantContextType = [Participant | null, (participant: Participant) => void];\r\n\r\nexport const selectedParticipantContext = createContext<selectedParticipantContextType>(null!);\r\n\r\nexport default function useSelectedParticipant() {\r\n  const [selectedParticipant, setSelectedParticipant] = useContext(selectedParticipantContext);\r\n  return [selectedParticipant, setSelectedParticipant] as const;\r\n}\r\n\r\ntype SelectedParticipantProviderProps = {\r\n  room: Room;\r\n  children: React.ReactNode;\r\n};\r\n\r\nexport function SelectedParticipantProvider({ room, children }: SelectedParticipantProviderProps) {\r\n  const [selectedParticipant, _setSelectedParticipant] = useState<Participant | null>(null);\r\n  const setSelectedParticipant = (participant: Participant) =>\r\n    _setSelectedParticipant(prevParticipant => (prevParticipant === participant ? null : participant));\r\n\r\n  useEffect(() => {\r\n    const onDisconnect = () => _setSelectedParticipant(null);\r\n    room.on('disconnected', onDisconnect);\r\n    return () => {\r\n      room.off('disconnected', onDisconnect);\r\n    };\r\n  }, [room]);\r\n\r\n  return (\r\n    <selectedParticipantContext.Provider value={[selectedParticipant, setSelectedParticipant]}>\r\n      {children}\r\n    </selectedParticipantContext.Provider>\r\n  );\r\n}\r\n","export const isMobile = (() => {\r\n  if (typeof navigator === 'undefined' || typeof navigator.userAgent !== 'string') {\r\n    return false;\r\n  }\r\n  return /Mobile/.test(navigator.userAgent);\r\n})();\r\n\r\n// This function ensures that the user has granted the browser permission to use audio and video\r\n// devices. If permission has not been granted, it will cause the browser to ask for permission\r\n// for audio and video at the same time (as opposed to separate requests).\r\nexport function ensureMediaPermissions() {\r\n  return navigator.mediaDevices\r\n    .enumerateDevices()\r\n    .then(devices => devices.every(device => !(device.deviceId && device.label)))\r\n    .then(shouldAskForMediaPermissions => {\r\n      if (shouldAskForMediaPermissions) {\r\n        return navigator.mediaDevices\r\n          .getUserMedia({ audio: true, video: true })\r\n          .then(mediaStream => mediaStream.getTracks().forEach(track => track.stop()));\r\n      }\r\n    });\r\n}\r\n","import { LocalVideoTrack } from 'twilio-video';\r\nimport { useCallback } from 'react';\r\nimport useVideoContext from '../useVideoContext/useVideoContext';\r\n\r\nexport default function useLocalVideoToggle() {\r\n  const {\r\n    room: { localParticipant },\r\n    localTracks,\r\n    getLocalVideoTrack,\r\n  } = useVideoContext();\r\n  const videoTrack = localTracks.find(track => track.name.includes('camera')) as LocalVideoTrack;\r\n\r\n  const toggleVideoEnabled = useCallback(() => {\r\n    if (videoTrack) {\r\n      if (localParticipant) {\r\n        const localTrackPublication = localParticipant.unpublishTrack(videoTrack);\r\n        // TODO: remove when SDK implements this event. See: https://issues.corp.twilio.com/browse/JSDK-2592\r\n        localParticipant.emit('trackUnpublished', localTrackPublication);\r\n      }\r\n      videoTrack.stop();\r\n    } else {\r\n      getLocalVideoTrack().then((track: LocalVideoTrack) => {\r\n        if (localParticipant) {\r\n          localParticipant.publishTrack(track, { priority: 'low' });\r\n        }\r\n      });\r\n    }\r\n  }, [videoTrack, localParticipant, getLocalVideoTrack]);\r\n\r\n  return [!!videoTrack, toggleVideoEnabled] as const;\r\n}\r\n","import { isMobile } from '../../../utils';\r\nimport { useEffect, useRef } from 'react';\r\nimport useLocalVideoToggle from '../../../hooks/useLocalVideoToggle/useLocalVideoToggle';\r\nimport useVideoContext from '../../../hooks/useVideoContext/useVideoContext';\r\n\r\n/* \r\n  This component adds a visibilitychange handler to the document when\r\n  the user is using a mobile device. When the handler detects that\r\n  the browser has been backgrounded, it unpublishes the users local\r\n  video track. The browser cannot send video to the room when it has\r\n  been backgrounded, so unpublishing the track stops video capture\r\n  on the device, and triggers a UI update for all other participants\r\n  to show that this user's video track has been turned off.\r\n*/\r\n\r\nexport default function AttachVisibilityHandler() {\r\n  const { room } = useVideoContext();\r\n  const [isVideoEnabled, toggleVideoEnabled] = useLocalVideoToggle();\r\n  const shouldRepublishVideoOnForeground = useRef(false);\r\n\r\n  useEffect(() => {\r\n    if (isMobile) {\r\n      const handleVisibilityChange = () => {\r\n        // We don't need to unpublish the local video track if it has already been unpublished\r\n        if (document.visibilityState === 'hidden' && isVideoEnabled) {\r\n          shouldRepublishVideoOnForeground.current = true;\r\n          toggleVideoEnabled();\r\n\r\n          // Don't publish the local video track if it wasn't published before the app was backgrounded\r\n        } else if (shouldRepublishVideoOnForeground.current) {\r\n          shouldRepublishVideoOnForeground.current = false;\r\n          toggleVideoEnabled();\r\n        }\r\n      };\r\n\r\n      document.addEventListener('visibilitychange', handleVisibilityChange);\r\n      return () => {\r\n        document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n      };\r\n    }\r\n  }, [isVideoEnabled, room, toggleVideoEnabled]);\r\n\r\n  return null;\r\n}\r\n","import { useCallback, useEffect, useState } from 'react';\r\n\r\nimport { ensureMediaPermissions } from '../../../utils';\r\nimport Video, { LocalVideoTrack, LocalAudioTrack, CreateLocalTrackOptions } from 'twilio-video';\r\n\r\nexport function useLocalAudioTrack() {\r\n  const [track, setTrack] = useState<LocalAudioTrack>();\r\n\r\n  const getLocalAudioTrack = useCallback((deviceId?: string) => {\r\n    const options: CreateLocalTrackOptions = {};\r\n\r\n    if (deviceId) {\r\n      options.deviceId = { exact: deviceId };\r\n    }\r\n\r\n    return ensureMediaPermissions().then(() =>\r\n      Video.createLocalAudioTrack(options).then(newTrack => {\r\n        setTrack(newTrack);\r\n        return newTrack;\r\n      })\r\n    );\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    getLocalAudioTrack();\r\n  }, [getLocalAudioTrack]);\r\n\r\n  useEffect(() => {\r\n    const handleStopped = () => setTrack(undefined);\r\n    if (track) {\r\n      track.on('stopped', handleStopped);\r\n      return () => {\r\n        track.off('stopped', handleStopped);\r\n      };\r\n    }\r\n  }, [track]);\r\n\r\n  return [track, getLocalAudioTrack] as const;\r\n}\r\n\r\nexport function useLocalVideoTrack() {\r\n  const [track, setTrack] = useState<LocalVideoTrack>();\r\n\r\n  const getLocalVideoTrack = useCallback((newOptions?: CreateLocalTrackOptions) => {\r\n    // In the DeviceSelector and FlipCameraButton components, a new video track is created,\r\n    // then the old track is unpublished and the new track is published. Unpublishing the old\r\n    // track and publishing the new track at the same time sometimes causes a conflict when the\r\n    // track name is 'camera', so here we append a timestamp to the track name to avoid the\r\n    // conflict.\r\n    const options: CreateLocalTrackOptions = {\r\n      frameRate: 24,\r\n      height: 720,\r\n      width: 1280,\r\n      name: `camera-${Date.now()}`,\r\n      ...newOptions,\r\n    };\r\n\r\n    return ensureMediaPermissions().then(() =>\r\n      Video.createLocalVideoTrack(options).then(newTrack => {\r\n        setTrack(newTrack);\r\n        return newTrack;\r\n      })\r\n    );\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    // We get a new local video track when the app loads.\r\n    getLocalVideoTrack();\r\n  }, [getLocalVideoTrack]);\r\n\r\n  useEffect(() => {\r\n    const handleStopped = () => setTrack(undefined);\r\n    if (track) {\r\n      track.on('stopped', handleStopped);\r\n      return () => {\r\n        track.off('stopped', handleStopped);\r\n      };\r\n    }\r\n  }, [track]);\r\n\r\n  return [track, getLocalVideoTrack] as const;\r\n}\r\n\r\nexport default function useLocalTracks() {\r\n  const [audioTrack, getLocalAudioTrack] = useLocalAudioTrack();\r\n  const [videoTrack, getLocalVideoTrack] = useLocalVideoTrack();\r\n\r\n  const localTracks = [audioTrack, videoTrack].filter(track => track !== undefined) as (\r\n    | LocalAudioTrack\r\n    | LocalVideoTrack\r\n  )[];\r\n\r\n  return { localTracks, getLocalVideoTrack, getLocalAudioTrack };\r\n}\r\n","import { Callback } from '../../../types';\r\nimport EventEmitter from 'events';\r\nimport { isMobile } from '../../../utils';\r\nimport Video, { ConnectOptions, LocalTrack, Room } from 'twilio-video';\r\nimport { useCallback, useEffect, useRef, useState } from 'react';\r\n\r\n// @ts-ignore\r\nwindow.TwilioVideo = Video;\r\n\r\nexport default function useRoom(localTracks: LocalTrack[], onError: Callback, options?: ConnectOptions) {\r\n  const [room, setRoom] = useState<Room>(new EventEmitter() as Room);\r\n  const [isConnecting, setIsConnecting] = useState(false);\r\n  const localTracksRef = useRef<LocalTrack[]>([]);\r\n\r\n  useEffect(() => {\r\n    // It can take a moment for Video.connect to connect to a room. During this time, the user may have enabled or disabled their\r\n    // local audio or video tracks. If this happens, we store the localTracks in this ref, so that they are correctly published\r\n    // once the user is connected to the room.\r\n    localTracksRef.current = localTracks;\r\n  }, [localTracks]);\r\n\r\n  const connect = useCallback(\r\n    token => {\r\n      setIsConnecting(true);\r\n      return Video.connect(token, { ...options, tracks: [] }).then(\r\n        newRoom => {\r\n          setRoom(newRoom);\r\n          const disconnect = () => newRoom.disconnect();\r\n\r\n          newRoom.once('disconnected', () => {\r\n            // Reset the room only after all other `disconnected` listeners have been called.\r\n            setTimeout(() => setRoom(new EventEmitter() as Room));\r\n            window.removeEventListener('beforeunload', disconnect);\r\n\r\n            if (isMobile) {\r\n              window.removeEventListener('pagehide', disconnect);\r\n            }\r\n          });\r\n\r\n          // @ts-ignore\r\n          window.twilioRoom = newRoom;\r\n\r\n          localTracksRef.current.forEach(track =>\r\n            // Tracks can be supplied as arguments to the Video.connect() function and they will automatically be published.\r\n            // However, tracks must be published manually in order to set the priority on them.\r\n            // All video tracks are published with 'low' priority. This works because the video\r\n            // track that is displayed in the 'MainParticipant' component will have it's priority\r\n            // set to 'high' via track.setPriority()\r\n            newRoom.localParticipant.publishTrack(track, { priority: track.kind === 'video' ? 'low' : 'standard' })\r\n          );\r\n\r\n          setIsConnecting(false);\r\n\r\n          // Add a listener to disconnect from the room when a user closes their browser\r\n          window.addEventListener('beforeunload', disconnect);\r\n\r\n          if (isMobile) {\r\n            // Add a listener to disconnect from the room when a mobile user closes their browser\r\n            window.addEventListener('pagehide', disconnect);\r\n          }\r\n        },\r\n        error => {\r\n          onError(error);\r\n          setIsConnecting(false);\r\n        }\r\n      );\r\n    },\r\n    [options, onError]\r\n  );\r\n\r\n  return { room, isConnecting, connect };\r\n}\r\n","import React, { createContext, ReactNode } from 'react';\r\nimport {\r\n  CreateLocalTrackOptions,\r\n  ConnectOptions,\r\n  LocalAudioTrack,\r\n  LocalVideoTrack,\r\n  Room,\r\n  TwilioError,\r\n} from 'twilio-video';\r\nimport { Callback, ErrorCallback } from '../../types';\r\nimport { SelectedParticipantProvider } from './useSelectedParticipant/useSelectedParticipant';\r\n\r\nimport AttachVisibilityHandler from './AttachVisibilityHandler/AttachVisibilityHandler';\r\nimport useHandleRoomDisconnectionErrors from './useHandleRoomDisconnectionErrors/useHandleRoomDisconnectionErrors';\r\nimport useHandleOnDisconnect from './useHandleOnDisconnect/useHandleOnDisconnect';\r\nimport useHandleTrackPublicationFailed from './useHandleTrackPublicationFailed/useHandleTrackPublicationFailed';\r\nimport useLocalTracks from './useLocalTracks/useLocalTracks';\r\nimport useRoom from './useRoom/useRoom';\r\n\r\n/*\r\n *  The hooks used by the VideoProvider component are different than the hooks found in the 'hooks/' directory. The hooks\r\n *  in the 'hooks/' directory can be used anywhere in a video application, and they can be used any number of times.\r\n *  the hooks in the 'VideoProvider/' directory are intended to be used by the VideoProvider component only. Using these hooks\r\n *  elsewhere in the application may cause problems as these hooks should not be used more than once in an application.\r\n */\r\n\r\nexport interface IVideoContext {\r\n  room: Room;\r\n  localTracks: (LocalAudioTrack | LocalVideoTrack)[];\r\n  isConnecting: boolean;\r\n  connect: (token: string) => Promise<void>;\r\n  onError: ErrorCallback;\r\n  onDisconnect: Callback;\r\n  getLocalVideoTrack: (newOptions?: CreateLocalTrackOptions) => Promise<LocalVideoTrack>;\r\n  getLocalAudioTrack: (deviceId?: string) => Promise<LocalAudioTrack>;\r\n}\r\n\r\nexport const VideoContext = createContext<IVideoContext>(null!);\r\n\r\ninterface VideoProviderProps {\r\n  options?: ConnectOptions;\r\n  onError: ErrorCallback;\r\n  onDisconnect?: Callback;\r\n  children: ReactNode;\r\n}\r\n\r\nexport function VideoProvider({ options, children, onError = () => {}, onDisconnect = () => {} }: VideoProviderProps) {\r\n  const onErrorCallback = (error: TwilioError) => {\r\n    console.log(`ERROR: ${error.message}`, error);\r\n    onError(error);\r\n  };\r\n\r\n  const { localTracks, getLocalVideoTrack, getLocalAudioTrack } = useLocalTracks();\r\n  const { room, isConnecting, connect } = useRoom(localTracks, onErrorCallback, options);\r\n\r\n  // Register onError and onDisconnect callback functions.\r\n  useHandleRoomDisconnectionErrors(room, onError);\r\n  useHandleTrackPublicationFailed(room, onError);\r\n  useHandleOnDisconnect(room, onDisconnect);\r\n\r\n  return (\r\n    <VideoContext.Provider\r\n      value={{\r\n        room,\r\n        localTracks,\r\n        isConnecting,\r\n        onError: onErrorCallback,\r\n        onDisconnect,\r\n        getLocalVideoTrack,\r\n        getLocalAudioTrack,\r\n        connect,\r\n      }}\r\n    >\r\n      <SelectedParticipantProvider room={room}>{children}</SelectedParticipantProvider>\r\n      {/* \r\n        The AttachVisibilityHandler component is using the useLocalVideoToggle hook\r\n        which must be used within the VideoContext Provider.\r\n      */}\r\n      <AttachVisibilityHandler />\r\n    </VideoContext.Provider>\r\n  );\r\n}\r\n","import { Room, TwilioError } from 'twilio-video';\r\nimport { useEffect } from 'react';\r\n\r\nimport { Callback } from '../../../types';\r\n\r\nexport default function useHandleRoomDisconnectionErrors(room: Room, onError: Callback) {\r\n  useEffect(() => {\r\n    const onDisconnected = (room: Room, error: TwilioError) => {\r\n      if (error) {\r\n        onError(error);\r\n      }\r\n    };\r\n\r\n    room.on('disconnected', onDisconnected);\r\n    return () => {\r\n      room.off('disconnected', onDisconnected);\r\n    };\r\n  }, [room, onError]);\r\n}\r\n","import { Room } from 'twilio-video';\r\nimport { useEffect } from 'react';\r\n\r\nimport { Callback } from '../../../types';\r\n\r\nexport default function useHandleTrackPublicationFailed(room: Room, onError: Callback) {\r\n  const { localParticipant } = room;\r\n  useEffect(() => {\r\n    if (localParticipant) {\r\n      localParticipant.on('trackPublicationFailed', onError);\r\n      return () => {\r\n        localParticipant.off('trackPublicationFailed', onError);\r\n      };\r\n    }\r\n  }, [localParticipant, onError]);\r\n}\r\n","import { useEffect } from 'react';\r\nimport { Room } from 'twilio-video';\r\nimport { Callback } from '../../../types';\r\n\r\nexport default function useHandleOnDisconnect(room: Room, onDisconnect: Callback) {\r\n  useEffect(() => {\r\n    room.on('disconnected', onDisconnect);\r\n    return () => {\r\n      room.off('disconnected', onDisconnect);\r\n    };\r\n  }, [room, onDisconnect]);\r\n}\r\n","import { useContext } from 'react';\r\nimport { VideoContext } from '../../components/VideoProvider';\r\n\r\nexport default function useVideoContext() {\r\n  const context = useContext(VideoContext);\r\n  if (!context) {\r\n    throw new Error('useVideoContext must be used within a VideoProvider');\r\n  }\r\n  return context;\r\n}\r\n","import React from 'react';\r\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\r\n\r\nimport CallEnd from '@material-ui/icons/CallEnd';\r\nimport Fab from '@material-ui/core/Fab';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\n\r\nimport useVideoContext from '../../../hooks/useVideoContext/useVideoContext';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    fab: {\r\n      margin: theme.spacing(1),\r\n    },\r\n  })\r\n);\r\n\r\nexport default function EndCallButton() {\r\n  const classes = useStyles();\r\n  const { room } = useVideoContext();\r\n\r\n  return (\r\n    <Tooltip title={'End Call'} onClick={() => room.disconnect()} placement=\"top\" PopperProps={{ disablePortal: true }}>\r\n      <Fab className={classes.fab} color=\"primary\">\r\n        <CallEnd />\r\n      </Fab>\r\n    </Tooltip>\r\n  );\r\n}\r\n","import { useState, useEffect } from 'react';\r\nimport { LocalAudioTrack, LocalVideoTrack, RemoteAudioTrack, RemoteVideoTrack } from 'twilio-video';\r\n\r\ntype TrackType = LocalAudioTrack | LocalVideoTrack | RemoteAudioTrack | RemoteVideoTrack | undefined;\r\n\r\nexport default function useIsTrackEnabled(track: TrackType) {\r\n  const [isEnabled, setIsEnabled] = useState(track ? track.isEnabled : true);\r\n\r\n  useEffect(() => {\r\n    setIsEnabled(track ? track.isEnabled : true);\r\n\r\n    if (track) {\r\n      const setEnabled = () => setIsEnabled(true);\r\n      const setDisabled = () => setIsEnabled(false);\r\n      track.on('enabled', setEnabled);\r\n      track.on('disabled', setDisabled);\r\n      return () => {\r\n        track.off('enabled', setEnabled);\r\n        track.off('disabled', setDisabled);\r\n      };\r\n    }\r\n  }, [track]);\r\n\r\n  return isEnabled;\r\n}\r\n","import React from 'react';\r\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\r\n\r\nimport Fab from '@material-ui/core/Fab';\r\nimport Mic from '@material-ui/icons/Mic';\r\nimport MicOff from '@material-ui/icons/MicOff';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\n\r\nimport useLocalAudioToggle from '../../../hooks/useLocalAudioToggle/useLocalAudioToggle';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    fab: {\r\n      margin: theme.spacing(1),\r\n    },\r\n  })\r\n);\r\n\r\nexport default function ToggleAudioButton(props: { disabled?: boolean }) {\r\n  const classes = useStyles();\r\n  const [isAudioEnabled, toggleAudioEnabled] = useLocalAudioToggle();\r\n\r\n  return (\r\n    <Tooltip\r\n      title={isAudioEnabled ? 'Mute Audio' : 'Unmute Audio'}\r\n      placement=\"top\"\r\n      PopperProps={{ disablePortal: true }}\r\n    >\r\n      <Fab className={classes.fab} onClick={toggleAudioEnabled} disabled={props.disabled} data-cy-audio-toggle>\r\n        {isAudioEnabled ? <Mic /> : <MicOff />}\r\n      </Fab>\r\n    </Tooltip>\r\n  );\r\n}\r\n","import { LocalAudioTrack } from 'twilio-video';\r\nimport { useCallback } from 'react';\r\nimport useIsTrackEnabled from '../useIsTrackEnabled/useIsTrackEnabled';\r\nimport useVideoContext from '../useVideoContext/useVideoContext';\r\n\r\nexport default function useLocalAudioToggle() {\r\n  const { localTracks } = useVideoContext();\r\n  const audioTrack = localTracks.find(track => track.kind === 'audio') as LocalAudioTrack;\r\n  const isEnabled = useIsTrackEnabled(audioTrack);\r\n\r\n  const toggleAudioEnabled = useCallback(() => {\r\n    if (audioTrack) {\r\n      audioTrack.isEnabled ? audioTrack.disable() : audioTrack.enable();\r\n    }\r\n  }, [audioTrack]);\r\n\r\n  return [isEnabled, toggleAudioEnabled] as const;\r\n}\r\n","import React from 'react';\r\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\r\n\r\nimport Fab from '@material-ui/core/Fab';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\nimport Videocam from '@material-ui/icons/Videocam';\r\nimport VideocamOff from '@material-ui/icons/VideocamOff';\r\n\r\nimport useLocalVideoToggle from '../../../hooks/useLocalVideoToggle/useLocalVideoToggle';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    fab: {\r\n      margin: theme.spacing(1),\r\n    },\r\n  })\r\n);\r\n\r\nexport default function ToggleVideoButton(props: { disabled?: boolean }) {\r\n  const classes = useStyles();\r\n  const [isVideoEnabled, toggleVideoEnabled] = useLocalVideoToggle();\r\n\r\n  return (\r\n    <Tooltip\r\n      title={isVideoEnabled ? 'Mute Video' : 'Unmute Video'}\r\n      placement=\"top\"\r\n      PopperProps={{ disablePortal: true }}\r\n    >\r\n      <Fab className={classes.fab} onClick={toggleVideoEnabled} disabled={props.disabled}>\r\n        {isVideoEnabled ? <Videocam /> : <VideocamOff />}\r\n      </Fab>\r\n    </Tooltip>\r\n  );\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport useVideoContext from '../useVideoContext/useVideoContext';\r\n\r\nimport { Participant, TrackPublication } from 'twilio-video';\r\n\r\n/*\r\n  Returns the participant that is sharing their screen (if any). This hook assumes that only one participant\r\n  can share their screen at a time.\r\n*/\r\nexport default function useScreenShareParticipant() {\r\n  const { room } = useVideoContext();\r\n  const [screenShareParticipant, setScreenShareParticipant] = useState<Participant>();\r\n\r\n  useEffect(() => {\r\n    if (room.state === 'connected') {\r\n      const updateScreenShareParticipant = () => {\r\n        setScreenShareParticipant(\r\n          Array.from<Participant>(room.participants.values())\r\n            // the screenshare participant could be the localParticipant\r\n            .concat(room.localParticipant)\r\n            .find((participant: Participant) =>\r\n              Array.from<TrackPublication>(participant.tracks.values()).find(track =>\r\n                track.trackName.includes('screen')\r\n              )\r\n            )\r\n        );\r\n      };\r\n      updateScreenShareParticipant();\r\n\r\n      room.on('trackPublished', updateScreenShareParticipant);\r\n      room.on('trackUnpublished', updateScreenShareParticipant);\r\n      room.on('participantDisconnected', updateScreenShareParticipant);\r\n\r\n      // the room object does not emit 'trackPublished' events for the localParticipant,\r\n      // so we need to listen for them here.\r\n      room.localParticipant.on('trackPublished', updateScreenShareParticipant);\r\n      room.localParticipant.on('trackUnpublished', updateScreenShareParticipant);\r\n      return () => {\r\n        room.off('trackPublished', updateScreenShareParticipant);\r\n        room.off('trackUnpublished', updateScreenShareParticipant);\r\n        room.off('participantDisconnected', updateScreenShareParticipant);\r\n\r\n        room.localParticipant.off('trackPublished', updateScreenShareParticipant);\r\n        room.localParticipant.off('trackUnpublished', updateScreenShareParticipant);\r\n      };\r\n    }\r\n  }, [room]);\r\n\r\n  return screenShareParticipant;\r\n}\r\n","import React from 'react';\r\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\r\n\r\nimport Fab from '@material-ui/core/Fab';\r\nimport ScreenShare from '@material-ui/icons/ScreenShare';\r\nimport StopScreenShare from '@material-ui/icons/StopScreenShare';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\n\r\nimport useScreenShareToggle from '../../../hooks/useScreenShareToggle/useScreenShareToggle';\r\nimport useScreenShareParticipant from '../../../hooks/useScreenShareParticipant/useScreenShareParticipant';\r\nimport useVideoContext from '../../../hooks/useVideoContext/useVideoContext';\r\n\r\nexport const SCREEN_SHARE_TEXT = 'Share Screen';\r\nexport const STOP_SCREEN_SHARE_TEXT = 'Stop Sharing Screen';\r\nexport const SHARE_IN_PROGRESS_TEXT = 'Cannot share screen when another user is sharing';\r\nexport const SHARE_NOT_SUPPORTED_TEXT = 'Screen sharing is not supported with this browser';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    fab: {\r\n      margin: theme.spacing(1),\r\n      '&[disabled]': {\r\n        color: 'rgba(225, 225, 225, 0.8)',\r\n        backgroundColor: 'rgba(175, 175, 175, 0.6);',\r\n      },\r\n    },\r\n  })\r\n);\r\n\r\nexport default function ToggleScreenShareButton(props: { disabled?: boolean }) {\r\n  const classes = useStyles();\r\n  const [isScreenShared, toggleScreenShare] = useScreenShareToggle();\r\n  const screenShareParticipant = useScreenShareParticipant();\r\n  const { room } = useVideoContext();\r\n  const disableScreenShareButton = screenShareParticipant && screenShareParticipant !== room.localParticipant;\r\n  const isScreenShareSupported = navigator.mediaDevices && navigator.mediaDevices.getDisplayMedia;\r\n  const isDisabled = props.disabled || disableScreenShareButton || !isScreenShareSupported;\r\n\r\n  let tooltipMessage = SCREEN_SHARE_TEXT;\r\n\r\n  if (isScreenShared) {\r\n    tooltipMessage = STOP_SCREEN_SHARE_TEXT;\r\n  }\r\n\r\n  if (disableScreenShareButton) {\r\n    tooltipMessage = SHARE_IN_PROGRESS_TEXT;\r\n  }\r\n\r\n  if (!isScreenShareSupported) {\r\n    tooltipMessage = SHARE_NOT_SUPPORTED_TEXT;\r\n  }\r\n\r\n  return (\r\n    <Tooltip\r\n      title={tooltipMessage}\r\n      placement=\"top\"\r\n      PopperProps={{ disablePortal: true }}\r\n      style={{ cursor: isDisabled ? 'not-allowed' : 'pointer' }}\r\n    >\r\n      <div>\r\n        {/* The div element is needed because a disabled button will not emit hover events and we want to display\r\n          a tooltip when screen sharing is disabled */}\r\n        <Fab className={classes.fab} onClick={toggleScreenShare} disabled={isDisabled}>\r\n          {isScreenShared ? <StopScreenShare /> : <ScreenShare />}\r\n        </Fab>\r\n      </div>\r\n    </Tooltip>\r\n  );\r\n}\r\n","import { useState, useCallback, useRef } from 'react';\r\nimport useVideoContext from '../useVideoContext/useVideoContext';\r\nimport { LogLevels, Track } from 'twilio-video';\r\n\r\ninterface MediaStreamTrackPublishOptions {\r\n  name?: string;\r\n  priority: Track.Priority;\r\n  logLevel: LogLevels;\r\n}\r\n\r\nexport default function useScreenShareToggle() {\r\n  const { room, onError } = useVideoContext();\r\n  const [isSharing, setIsSharing] = useState(false);\r\n  const stopScreenShareRef = useRef<() => void>(null!);\r\n\r\n  const shareScreen = useCallback(() => {\r\n    navigator.mediaDevices\r\n      .getDisplayMedia({\r\n        audio: false,\r\n        video: {\r\n          frameRate: 10,\r\n          height: 1080,\r\n          width: 1920,\r\n        },\r\n      })\r\n      .then(stream => {\r\n        const track = stream.getTracks()[0];\r\n\r\n        // All video tracks are published with 'low' priority. This works because the video\r\n        // track that is displayed in the 'MainParticipant' component will have it's priority\r\n        // set to 'high' via track.setPriority()\r\n        room.localParticipant\r\n          .publishTrack(track, {\r\n            name: 'screen', // Tracks can be named to easily find them later\r\n            priority: 'low', // Priority is set to high by the subscriber when the video track is rendered\r\n          } as MediaStreamTrackPublishOptions)\r\n          .then(trackPublication => {\r\n            stopScreenShareRef.current = () => {\r\n              room.localParticipant.unpublishTrack(track);\r\n              // TODO: remove this if the SDK is updated to emit this event\r\n              room.localParticipant.emit('trackUnpublished', trackPublication);\r\n              track.stop();\r\n              setIsSharing(false);\r\n            };\r\n\r\n            track.onended = stopScreenShareRef.current;\r\n            setIsSharing(true);\r\n          })\r\n          .catch(onError);\r\n      })\r\n      .catch(error => {\r\n        // Don't display an error if the user closes the screen share dialog\r\n        if (error.name !== 'AbortError' && error.name !== 'NotAllowedError') {\r\n          onError(error);\r\n        }\r\n      });\r\n  }, [room, onError]);\r\n\r\n  const toggleScreenShare = useCallback(() => {\r\n    !isSharing ? shareScreen() : stopScreenShareRef.current();\r\n  }, [isSharing, shareScreen, stopScreenShareRef]);\r\n\r\n  return [isSharing, toggleScreenShare] as const;\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport useVideoContext from '../useVideoContext/useVideoContext';\r\n\r\ntype RoomStateType = 'disconnected' | 'connected' | 'reconnecting';\r\n\r\nexport default function useRoomState() {\r\n  const { room } = useVideoContext();\r\n  const [state, setState] = useState<RoomStateType>('disconnected');\r\n\r\n  useEffect(() => {\r\n    const setRoomState = () => setState((room.state || 'disconnected') as RoomStateType);\r\n    setRoomState();\r\n    room\r\n      .on('disconnected', setRoomState)\r\n      .on('reconnected', setRoomState)\r\n      .on('reconnecting', setRoomState);\r\n    return () => {\r\n      room\r\n        .off('disconnected', setRoomState)\r\n        .off('reconnected', setRoomState)\r\n        .off('reconnecting', setRoomState);\r\n    };\r\n  }, [room]);\r\n\r\n  return state;\r\n}\r\n","import React from 'react';\r\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\r\nimport clsx from 'clsx';\r\n\r\nimport EndCallButton from './EndCallButton/EndCallButton';\r\nimport ToggleAudioButton from './ToggleAudioButton/ToggleAudioButton';\r\nimport ToggleVideoButton from './ToggleVideoButton/ToggleVideoButton';\r\nimport ToggleScreenShareButton from './ToogleScreenShareButton/ToggleScreenShareButton';\r\n\r\nimport useIsUserActive from './useIsUserActive/useIsUserActive';\r\nimport useRoomState from '../../hooks/useRoomState/useRoomState';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    container: {\r\n      display: 'flex',\r\n      position: 'absolute',\r\n      right: '50%',\r\n      transform: 'translate(50%, 30px)',\r\n      bottom: '50px',\r\n      zIndex: 1,\r\n      transition: 'opacity 1.2s, transform 1.2s, visibility 0s 1.2s',\r\n      opacity: 0,\r\n      visibility: 'hidden',\r\n      maxWidth: 'min-content',\r\n      '&.showControls, &:hover': {\r\n        transition: 'opacity 0.6s, transform 0.6s, visibility 0s',\r\n        opacity: 1,\r\n        visibility: 'visible',\r\n        transform: 'translate(50%, 0px)',\r\n      },\r\n      [theme.breakpoints.down('xs')]: {\r\n        bottom: `${theme.sidebarMobileHeight + 3}px`,\r\n      },\r\n    },\r\n  })\r\n);\r\n\r\nexport default function Controls() {\r\n  const classes = useStyles();\r\n  const roomState = useRoomState();\r\n  const isReconnecting = roomState === 'reconnecting';\r\n  const isUserActive = useIsUserActive();\r\n  const showControls = isUserActive || roomState === 'disconnected';\r\n\r\n  return (\r\n    <div className={clsx(classes.container, { showControls })}>\r\n      <ToggleAudioButton disabled={isReconnecting} />\r\n      <ToggleVideoButton disabled={isReconnecting} />\r\n      {roomState !== 'disconnected' && (\r\n        <>\r\n          <ToggleScreenShareButton disabled={isReconnecting} />\r\n          <EndCallButton />\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import { useEffect, useRef, useState } from 'react';\r\nimport throttle from 'lodash.throttle';\r\n\r\nexport default function useIsUserActive() {\r\n  const [isUserActive, setIsUserActive] = useState(true);\r\n  const timeoutIDRef = useRef(0);\r\n\r\n  useEffect(() => {\r\n    const handleUserActivity = throttle(() => {\r\n      setIsUserActive(true);\r\n      clearTimeout(timeoutIDRef.current);\r\n      const timeoutID = window.setTimeout(() => setIsUserActive(false), 5000);\r\n      timeoutIDRef.current = timeoutID;\r\n    }, 500);\r\n\r\n    handleUserActivity();\r\n\r\n    window.addEventListener('mousemove', handleUserActivity);\r\n    window.addEventListener('click', handleUserActivity);\r\n    window.addEventListener('keydown', handleUserActivity);\r\n    return () => {\r\n      window.removeEventListener('mousemove', handleUserActivity);\r\n      window.removeEventListener('click', handleUserActivity);\r\n      window.removeEventListener('keydown', handleUserActivity);\r\n      clearTimeout(timeoutIDRef.current);\r\n    };\r\n  }, []);\r\n\r\n  return isUserActive;\r\n}\r\n","import React, { useRef, useEffect } from 'react';\r\nimport { IVideoTrack } from '../../types';\r\nimport { styled } from '@material-ui/core/styles';\r\nimport { Track } from 'twilio-video';\r\n\r\nconst Video = styled('video')({\r\n  width: '100%',\r\n  maxHeight: '100%',\r\n  objectFit: 'contain',\r\n});\r\n\r\ninterface VideoTrackProps {\r\n  track: IVideoTrack;\r\n  isLocal?: boolean;\r\n  priority?: Track.Priority | null;\r\n}\r\n\r\nexport default function VideoTrack({ track, isLocal, priority }: VideoTrackProps) {\r\n  const ref = useRef<HTMLVideoElement>(null!);\r\n\r\n  useEffect(() => {\r\n    const el = ref.current;\r\n    el.muted = true;\r\n    if (track.setPriority && priority) {\r\n      track.setPriority(priority);\r\n    }\r\n    track.attach(el);\r\n    return () => {\r\n      track.detach(el);\r\n      if (track.setPriority && priority) {\r\n        // Passing `null` to setPriority will set the track's priority to that which it was published with.\r\n        track.setPriority(null);\r\n      }\r\n    };\r\n  }, [track, priority]);\r\n\r\n  // The local video track is mirrored.\r\n  const isFrontFacing = track.mediaStreamTrack.getSettings().facingMode !== 'environment';\r\n  const style = isLocal && isFrontFacing ? { transform: 'rotateY(180deg)' } : {};\r\n\r\n  return <Video ref={ref} style={style} />;\r\n}\r\n","import React from 'react';\r\nimport { LocalVideoTrack } from 'twilio-video';\r\nimport VideoTrack from '../VideoTrack/VideoTrack';\r\nimport useVideoContext from '../../hooks/useVideoContext/useVideoContext';\r\n\r\nexport default function LocalVideoPreview() {\r\n  const { localTracks } = useVideoContext();\r\n\r\n  const videoTrack = localTracks.find(track => track.name.includes('camera')) as LocalVideoTrack;\r\n\r\n  return videoTrack ? <VideoTrack track={videoTrack} isLocal /> : null;\r\n}\r\n","import React from 'react';\r\n\r\nimport FullscreenIcon from '@material-ui/icons/Fullscreen';\r\nimport fscreen from 'fscreen';\r\nimport FullscreenExitIcon from '@material-ui/icons/FullscreenExit';\r\nimport IconButton from '@material-ui/core/IconButton';\r\n\r\nimport useFullScreenToggle from '../../../hooks/useFullScreenToggle/useFullScreenToggle';\r\n\r\nexport default function ToggleFullscreenButton() {\r\n  const [isFullScreen, toggleFullScreen] = useFullScreenToggle();\r\n\r\n  return fscreen.fullscreenEnabled ? (\r\n    <IconButton aria-label={`full screen`} onClick={toggleFullScreen}>\r\n      {isFullScreen ? <FullscreenExitIcon /> : <FullscreenIcon />}\r\n    </IconButton>\r\n  ) : null;\r\n}\r\n","import { useCallback, useState, useEffect } from 'react';\r\nimport fscreen from 'fscreen';\r\n\r\nexport default function useFullScreenToggle() {\r\n  const [isFullScreen, setIsFullScreen] = useState<Boolean>(!!fscreen.fullscreenElement);\r\n\r\n  useEffect(() => {\r\n    const onFullScreenChange = () => setIsFullScreen(!!fscreen.fullscreenElement);\r\n    fscreen.addEventListener('fullscreenchange', onFullScreenChange);\r\n    return () => {\r\n      fscreen.removeEventListener('fullscreenchange', onFullScreenChange);\r\n    };\r\n  }, []);\r\n\r\n  const toggleFullScreen = useCallback(() => {\r\n    isFullScreen ? fscreen.exitFullscreen() : fscreen.requestFullscreen(document.documentElement);\r\n  }, [isFullScreen]);\r\n\r\n  return [isFullScreen, toggleFullScreen] as const;\r\n}\r\n","import React, { PropsWithChildren } from 'react';\r\nimport Button from '@material-ui/core/Button';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport DialogActions from '@material-ui/core/DialogActions';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport DialogContentText from '@material-ui/core/DialogContentText';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\n\r\nimport { version as appVersion } from '../../../../package.json';\r\nimport Video from 'twilio-video';\r\n\r\ninterface AboutDialogProps {\r\n  open: boolean;\r\n  onClose(): void;\r\n}\r\n\r\nfunction AboutDialog({ open, onClose }: PropsWithChildren<AboutDialogProps>) {\r\n  return (\r\n    <Dialog open={open} onClose={onClose} fullWidth={true} maxWidth=\"xs\">\r\n      <DialogTitle>About:</DialogTitle>\r\n      <DialogContent>\r\n        <DialogContentText>Browser supported: {String(Video.isSupported)}</DialogContentText>\r\n        <DialogContentText>SDK Version: {Video.version}</DialogContentText>\r\n        <DialogContentText>App Version: {appVersion}</DialogContentText>\r\n        <DialogContentText>Deployed Tag: {process.env.REACT_APP_GIT_TAG || 'N/A'}</DialogContentText>\r\n        <DialogContentText>Deployed Commit Hash: {process.env.REACT_APP_GIT_COMMIT || 'N/A'}</DialogContentText>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={onClose} color=\"primary\" autoFocus>\r\n          OK\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  );\r\n}\r\n\r\nexport default AboutDialog;\r\n","import React from 'react';\r\nimport Avatar from '@material-ui/core/Avatar';\r\nimport makeStyles from '@material-ui/styles/makeStyles';\r\nimport Person from '@material-ui/icons/Person';\r\nimport { StateContextType } from '../../../state';\r\n\r\nconst useStyles = makeStyles({\r\n  red: {\r\n    color: 'white',\r\n    backgroundColor: '#F22F46',\r\n  },\r\n});\r\n\r\nexport function getInitials(name: string) {\r\n  return name\r\n    .split(' ')\r\n    .map(text => text[0])\r\n    .join('')\r\n    .toUpperCase();\r\n}\r\n\r\nexport default function UserAvatar({ user }: { user: StateContextType['user'] }) {\r\n  const classes = useStyles();\r\n  const { displayName, photoURL } = user!;\r\n\r\n  return photoURL ? (\r\n    <Avatar src={photoURL} />\r\n  ) : (\r\n    <Avatar className={classes.red}>{displayName ? getInitials(displayName) : <Person />}</Avatar>\r\n  );\r\n}\r\n","import { useCallback, useEffect, useState } from 'react';\r\nimport * as firebase from 'firebase/app';\r\nimport 'firebase/auth';\r\n\r\nconst firebaseConfig = {\r\n  apiKey: process.env.REACT_APP_FIREBASE_API_KEY,\r\n  authDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,\r\n  databaseURL: process.env.REACT_APP_FIREBASE_DATABASE_URL,\r\n  storageBucket: process.env.REACT_APP_FIREBASE_STORAGE_BUCKET,\r\n  messagingSenderId: process.env.REACT_APP_FIREBASE_MESSAGING_SENDER_ID,\r\n};\r\n\r\nexport default function useFirebaseAuth() {\r\n  const [user, setUser] = useState<firebase.User | null>(null);\r\n  const [isAuthReady, setIsAuthReady] = useState(false);\r\n\r\n  const getToken = useCallback(\r\n    async (identity: string, roomName: string) => {\r\n      const headers = new window.Headers();\r\n\r\n      const idToken = await user!.getIdToken();\r\n      headers.set('Authorization', idToken);\r\n\r\n      const endpoint = process.env.REACT_APP_TOKEN_ENDPOINT || '/token';\r\n      const params = new window.URLSearchParams({ identity, roomName });\r\n\r\n      return fetch(`${endpoint}?${params}`, { headers }).then(res => res.text());\r\n    },\r\n    [user]\r\n  );\r\n\r\n  useEffect(() => {\r\n    firebase.initializeApp(firebaseConfig);\r\n    firebase.auth().onAuthStateChanged(user => {\r\n      setUser(user);\r\n      setIsAuthReady(true);\r\n    });\r\n  }, []);\r\n\r\n  const signIn = useCallback(() => {\r\n    const provider = new firebase.auth.GoogleAuthProvider();\r\n    provider.addScope('https://www.googleapis.com/auth/plus.login');\r\n\r\n    return firebase\r\n      .auth()\r\n      .signInWithPopup(provider)\r\n      .then(user => {\r\n        setUser(user.user);\r\n      });\r\n  }, []);\r\n\r\n  const signOut = useCallback(() => {\r\n    return firebase\r\n      .auth()\r\n      .signOut()\r\n      .then(() => {\r\n        setUser(null);\r\n      });\r\n  }, []);\r\n\r\n  return { user, signIn, signOut, isAuthReady, getToken };\r\n}\r\n","import { useCallback, useEffect, useState } from 'react';\r\nimport { useHistory } from 'react-router-dom';\r\n\r\nexport function getPasscode() {\r\n  const match = window.location.search.match(/passcode=(.*)&?/);\r\n  const passcode = match ? match[1] : window.sessionStorage.getItem('passcode');\r\n  return passcode;\r\n}\r\n\r\nexport function fetchToken(name: string, room: string, passcode: string) {\r\n  return fetch(`/token`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'content-type': 'application/json',\r\n    },\r\n    body: JSON.stringify({ user_identity: name, room_name: room, passcode }),\r\n  });\r\n}\r\n\r\nexport function verifyPasscode(passcode: string) {\r\n  return fetchToken('temp-name', 'temp-room', passcode).then(async res => {\r\n    const jsonResponse = await res.json();\r\n    if (res.status === 401) {\r\n      return { isValid: false, error: jsonResponse.error?.message };\r\n    }\r\n\r\n    if (res.ok && jsonResponse.token) {\r\n      return { isValid: true };\r\n    }\r\n  });\r\n}\r\n\r\nexport function getErrorMessage(message: string) {\r\n  switch (message) {\r\n    case 'passcode incorrect':\r\n      return 'Passcode is incorrect';\r\n    case 'passcode expired':\r\n      return 'Passcode has expired';\r\n    default:\r\n      return message;\r\n  }\r\n}\r\n\r\nexport default function usePasscodeAuth() {\r\n  const history = useHistory();\r\n\r\n  const [user, setUser] = useState<{ displayName: undefined; photoURL: undefined; passcode: string } | null>(null);\r\n  const [isAuthReady, setIsAuthReady] = useState(false);\r\n\r\n  const getToken = useCallback(\r\n    (name: string, room: string) => {\r\n      return fetchToken(name, room, user!.passcode)\r\n        .then(async res => {\r\n          if (res.ok) {\r\n            return res;\r\n          }\r\n          const json = await res.json();\r\n          const errorMessage = getErrorMessage(json.error?.message || res.statusText);\r\n          throw Error(errorMessage);\r\n        })\r\n        .then(res => res.json())\r\n        .then(res => res.token as string);\r\n    },\r\n    [user]\r\n  );\r\n\r\n  useEffect(() => {\r\n    const passcode = getPasscode();\r\n\r\n    if (passcode) {\r\n      verifyPasscode(passcode)\r\n        .then(verification => {\r\n          if (verification?.isValid) {\r\n            setUser({ passcode } as any);\r\n            window.sessionStorage.setItem('passcode', passcode);\r\n            history.replace(window.location.pathname);\r\n          }\r\n        })\r\n        .then(() => setIsAuthReady(true));\r\n    } else {\r\n      setIsAuthReady(true);\r\n    }\r\n  }, [history]);\r\n\r\n  const signIn = useCallback((passcode: string) => {\r\n    return verifyPasscode(passcode).then(verification => {\r\n      if (verification?.isValid) {\r\n        setUser({ passcode } as any);\r\n        window.sessionStorage.setItem('passcode', passcode);\r\n      } else {\r\n        throw new Error(getErrorMessage(verification?.error));\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  const signOut = useCallback(() => {\r\n    setUser(null);\r\n    window.sessionStorage.removeItem('passcode');\r\n    return Promise.resolve();\r\n  }, []);\r\n\r\n  return { user, isAuthReady, getToken, signIn, signOut };\r\n}\r\n","import React, { createContext, useContext, useState } from 'react';\r\nimport { TwilioError } from 'twilio-video';\r\nimport useFirebaseAuth from './useFirebaseAuth/useFirebaseAuth';\r\nimport usePasscodeAuth from './usePasscodeAuth/usePasscodeAuth';\r\nimport { User } from 'firebase';\r\n\r\nexport interface StateContextType {\r\n  error: TwilioError | null;\r\n  setError(error: TwilioError | null): void;\r\n  getToken(name: string, room: string, passcode?: string): Promise<string>;\r\n  user?: User | null | { displayName: undefined; photoURL: undefined; passcode?: string };\r\n  signIn?(passcode?: string): Promise<void>;\r\n  signOut?(): Promise<void>;\r\n  isAuthReady?: boolean;\r\n  isFetching: boolean;\r\n  activeSinkId: string;\r\n  setActiveSinkId(sinkId: string): void;\r\n}\r\n\r\nexport const StateContext = createContext<StateContextType>(null!);\r\n\r\n/*\r\n  The 'react-hooks/rules-of-hooks' linting rules prevent React Hooks fron being called\r\n  inside of if() statements. This is because hooks must always be called in the same order\r\n  every time a component is rendered. The 'react-hooks/rules-of-hooks' rule is disabled below\r\n  because the \"if (process.env.REACT_APP_SET_AUTH === 'firebase')\" statements are evaluated\r\n  at build time (not runtime). If the statement evaluates to false, then the code is not\r\n  included in the bundle that is produced (due to tree-shaking). Thus, in this instance, it\r\n  is ok to call hooks inside if() statements.\r\n*/\r\nexport default function AppStateProvider(props: React.PropsWithChildren<{}>) {\r\n  const [error, setError] = useState<TwilioError | null>(null);\r\n  const [isFetching, setIsFetching] = useState(false);\r\n  const [activeSinkId, setActiveSinkId] = useState('default');\r\n\r\n  let contextValue = {\r\n    error,\r\n    setError,\r\n    isFetching,\r\n    activeSinkId,\r\n    setActiveSinkId,\r\n  } as StateContextType;\r\n\r\n  if (process.env.REACT_APP_SET_AUTH === 'firebase') {\r\n    contextValue = {\r\n      ...contextValue,\r\n      ...useFirebaseAuth(), // eslint-disable-line react-hooks/rules-of-hooks\r\n    };\r\n  } else if (process.env.REACT_APP_SET_AUTH === 'passcode') {\r\n    contextValue = {\r\n      ...contextValue,\r\n      ...usePasscodeAuth(), // eslint-disable-line react-hooks/rules-of-hooks\r\n    };\r\n  } else {\r\n    contextValue = {\r\n      ...contextValue,\r\n      getToken: async (identity, roomName) => {\r\n        const headers = new window.Headers();\r\n        const endpoint = process.env.REACT_APP_TOKEN_ENDPOINT || '/token';\r\n        const params = new window.URLSearchParams({ identity, roomName });\r\n\r\n        return fetch(`${endpoint}?${params}`, { headers }).then(res => res.text());\r\n      },\r\n    };\r\n  }\r\n\r\n  const getToken: StateContextType['getToken'] = (name, room) => {\r\n    setIsFetching(true);\r\n    return contextValue\r\n      .getToken(name, room)\r\n      .then(res => {\r\n        setIsFetching(false);\r\n        return res;\r\n      })\r\n      .catch(err => {\r\n        setError(err);\r\n        setIsFetching(false);\r\n        return Promise.reject(err);\r\n      });\r\n  };\r\n\r\n  return <StateContext.Provider value={{ ...contextValue, getToken }}>{props.children}</StateContext.Provider>;\r\n}\r\n\r\nexport function useAppState() {\r\n  const context = useContext(StateContext);\r\n  if (!context) {\r\n    throw new Error('useAppState must be used within the AppStateProvider');\r\n  }\r\n  return context;\r\n}\r\n","import React, { useState, useRef, useCallback } from 'react';\r\nimport AboutDialog from '../AboutDialog/AboutDialog';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport MenuContainer from '@material-ui/core/Menu';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport MoreIcon from '@material-ui/icons/MoreVert';\r\nimport UserAvatar from '../UserAvatar/UserAvatar';\r\n\r\nimport { useAppState } from '../../../state';\r\nimport useVideoContext from '../../../hooks/useVideoContext/useVideoContext';\r\n\r\nexport default function Menu() {\r\n  const { user, signOut } = useAppState();\r\n  const { room, localTracks } = useVideoContext();\r\n\r\n  const [aboutOpen, setAboutOpen] = useState(false);\r\n  const [menuOpen, setMenuOpen] = useState(false);\r\n\r\n  const anchorRef = useRef<HTMLDivElement>(null);\r\n\r\n  const handleSignOut = useCallback(() => {\r\n    room.disconnect?.();\r\n    localTracks.forEach(track => track.stop());\r\n    signOut?.();\r\n  }, [room.disconnect, localTracks, signOut]);\r\n\r\n  return (\r\n    <div ref={anchorRef}>\r\n      <IconButton color=\"inherit\" onClick={() => setMenuOpen(state => !state)}>\r\n        {user ? <UserAvatar user={user} /> : <MoreIcon />}\r\n      </IconButton>\r\n      <MenuContainer open={menuOpen} onClose={() => setMenuOpen(state => !state)} anchorEl={anchorRef.current}>\r\n        {user?.displayName && <MenuItem disabled>{user.displayName}</MenuItem>}\r\n        <MenuItem onClick={() => setAboutOpen(true)}>About</MenuItem>\r\n        {user && <MenuItem onClick={handleSignOut}>Logout</MenuItem>}\r\n      </MenuContainer>\r\n      <AboutDialog\r\n        open={aboutOpen}\r\n        onClose={() => {\r\n          setAboutOpen(false);\r\n          setMenuOpen(false);\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","import React, { useCallback, useEffect, useState } from 'react';\r\nimport FlipCameraIosIcon from '@material-ui/icons/FlipCameraIos';\r\nimport { IconButton } from '@material-ui/core';\r\nimport useVideoContext from '../../../hooks/useVideoContext/useVideoContext';\r\n\r\nexport default function FlipCameraButton() {\r\n  const {\r\n    room: { localParticipant },\r\n    localTracks,\r\n    getLocalVideoTrack,\r\n  } = useVideoContext();\r\n  const [supportsFacingMode, setSupportsFacingMode] = useState<Boolean | null>(null);\r\n  const videoTrack = localTracks.find(track => track.name.includes('camera'));\r\n  const facingMode = videoTrack?.mediaStreamTrack.getSettings().facingMode;\r\n\r\n  useEffect(() => {\r\n    // The 'supportsFacingMode' variable determines if this component is rendered\r\n    // If 'facingMode' exists, we will set supportsFacingMode to true.\r\n    // However, if facingMode is ever undefined again (when the user unpublishes video), we\r\n    // won't set 'supportsFacingMode' to false. This prevents the icon from briefly\r\n    // disappearing when the user switches their front/rear camera.\r\n    if (facingMode && supportsFacingMode === null) {\r\n      setSupportsFacingMode(Boolean(facingMode));\r\n    }\r\n  }, [facingMode, supportsFacingMode]);\r\n\r\n  const toggleFacingMode = useCallback(() => {\r\n    const newFacingMode = facingMode === 'user' ? 'environment' : 'user';\r\n\r\n    videoTrack!.stop();\r\n\r\n    getLocalVideoTrack({ facingMode: newFacingMode }).then(newVideoTrack => {\r\n      const localTrackPublication = localParticipant?.unpublishTrack(videoTrack!);\r\n      // TODO: remove when SDK implements this event. See: https://issues.corp.twilio.com/browse/JSDK-2592\r\n      localParticipant?.emit('trackUnpublished', localTrackPublication);\r\n\r\n      localParticipant?.publishTrack(newVideoTrack, { priority: 'low' });\r\n    });\r\n  }, [facingMode, getLocalVideoTrack, localParticipant, videoTrack]);\r\n\r\n  return supportsFacingMode ? (\r\n    <IconButton onClick={toggleFacingMode} disabled={!videoTrack}>\r\n      <FlipCameraIosIcon />\r\n    </IconButton>\r\n  ) : null;\r\n}\r\n","import React, { useEffect, useRef } from 'react';\r\nimport { AudioTrack, LocalAudioTrack, RemoteAudioTrack } from 'twilio-video';\r\nimport { interval } from 'd3-timer';\r\nimport MicOff from '@material-ui/icons/MicOff';\r\nimport useIsTrackEnabled from '../../hooks/useIsTrackEnabled/useIsTrackEnabled';\r\n\r\nlet clipId = 0;\r\nconst getUniqueClipId = () => clipId++;\r\n\r\n// @ts-ignore\r\nconst AudioContext = window.AudioContext || window.webkitAudioContext;\r\nlet audioContext: AudioContext;\r\n\r\nexport function initializeAnalyser(stream: MediaStream) {\r\n  audioContext = audioContext || new AudioContext();\r\n  const audioSource = audioContext.createMediaStreamSource(stream);\r\n\r\n  const analyser = audioContext.createAnalyser();\r\n  analyser.smoothingTimeConstant = 0.4;\r\n  analyser.fftSize = 512;\r\n\r\n  audioSource.connect(analyser);\r\n  return analyser;\r\n}\r\n\r\nfunction AudioLevelIndicator({\r\n  size,\r\n  audioTrack,\r\n  background,\r\n}: {\r\n  size?: number;\r\n  audioTrack?: AudioTrack;\r\n  background?: string;\r\n}) {\r\n  const SIZE = size || 24;\r\n  const ref = useRef<SVGRectElement>(null);\r\n  const mediaStreamRef = useRef<MediaStream>();\r\n  const isTrackEnabled = useIsTrackEnabled(audioTrack as LocalAudioTrack | RemoteAudioTrack);\r\n\r\n  useEffect(() => {\r\n    // Here we listen for the 'stopped' event on the audioTrack. When the audioTrack is stopped,\r\n    // we stop the cloned track that is stored in mediaStreamRef. It is important that we stop\r\n    // all tracks when they are not in use. Browsers like Firefox don't let you create a stream\r\n    // from a new audio device while the active audio device still has active tracks.\r\n    const handleStopped = () => mediaStreamRef.current?.getTracks().forEach(track => track.stop());\r\n    audioTrack?.on('stopped', handleStopped);\r\n    return () => {\r\n      audioTrack?.off('stopped', handleStopped);\r\n    };\r\n  }, [audioTrack]);\r\n\r\n  useEffect(() => {\r\n    const SVGClipElement = ref.current;\r\n\r\n    if (audioTrack && isTrackEnabled && SVGClipElement) {\r\n      // Here we create a new MediaStream from a clone of the mediaStreamTrack.\r\n      // A clone is created to allow multiple instances of this component for a single\r\n      // AudioTrack on iOS Safari. It is stored in a ref so that the cloned track can be stopped\r\n      // when the original track is stopped.\r\n      mediaStreamRef.current = new MediaStream([audioTrack.mediaStreamTrack.clone()]);\r\n      let analyser = initializeAnalyser(mediaStreamRef.current);\r\n\r\n      const reinitializeAnalyser = () => {\r\n        analyser = initializeAnalyser(mediaStreamRef.current!);\r\n      };\r\n\r\n      // Here we reinitialize the AnalyserNode on focus to avoid an issue in Safari\r\n      // where the analysers stop functioning when the user switches to a new tab\r\n      // and switches back to the app.\r\n      window.addEventListener('focus', reinitializeAnalyser);\r\n\r\n      const sampleArray = new Uint8Array(analyser.frequencyBinCount);\r\n\r\n      const timer = interval(() => {\r\n        analyser.getByteFrequencyData(sampleArray);\r\n        let values = 0;\r\n\r\n        const length = sampleArray.length;\r\n        for (let i = 0; i < length; i++) {\r\n          values += sampleArray[i];\r\n        }\r\n\r\n        const volume = Math.min(21, Math.max(0, Math.log10(values / length / 3) * 14));\r\n\r\n        SVGClipElement?.setAttribute('y', String(21 - volume));\r\n      }, 50);\r\n\r\n      return () => {\r\n        SVGClipElement.setAttribute('y', '21');\r\n        timer.stop();\r\n        window.removeEventListener('focus', reinitializeAnalyser);\r\n      };\r\n    }\r\n  }, [audioTrack, isTrackEnabled]);\r\n\r\n  // Each instance of this component will need a unique HTML ID\r\n  const clipPathId = `audio-level-clip-${getUniqueClipId()}`;\r\n\r\n  return isTrackEnabled ? (\r\n    <svg focusable=\"false\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" height={`${SIZE}px`} width={`${SIZE}px`}>\r\n      <defs>\r\n        <clipPath id={clipPathId}>\r\n          <rect ref={ref} x=\"0\" y=\"21\" width=\"24\" height=\"24\" />\r\n        </clipPath>\r\n      </defs>\r\n      <path\r\n        fill={background || 'rgba(255, 255, 255, 0.1)'}\r\n        d=\"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z\"\r\n      ></path>\r\n      <path\r\n        fill=\"#0c0\"\r\n        clipPath={`url(#${clipPathId})`}\r\n        d=\"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z\"\r\n      ></path>\r\n    </svg>\r\n  ) : (\r\n    <MicOff\r\n      height={`${SIZE}px`}\r\n      width={`${SIZE}px`}\r\n      style={{ width: 'initial', height: 'initial' }}\r\n      data-cy-audio-mute-icon\r\n    />\r\n  );\r\n}\r\n\r\nexport default React.memo(AudioLevelIndicator);\r\n","import React from 'react';\r\nimport { LocalAudioTrack } from 'twilio-video';\r\nimport useVideoContext from '../../../../hooks/useVideoContext/useVideoContext';\r\nimport AudioLevelIndicator from '../../../AudioLevelIndicator/AudioLevelIndicator';\r\n\r\nexport default function LocalAudioLevelIndicator() {\r\n  const { localTracks } = useVideoContext();\r\n  const audioTrack = localTracks.find(track => track.kind === 'audio') as LocalAudioTrack;\r\n\r\n  return <AudioLevelIndicator size={30} audioTrack={audioTrack} />;\r\n}\r\n","import { useState, useEffect } from 'react';\r\nimport { ensureMediaPermissions } from '../../../../utils';\r\n\r\nexport function useDevices() {\r\n  const [devices, setDevices] = useState<MediaDeviceInfo[]>([]);\r\n\r\n  useEffect(() => {\r\n    const getDevices = () =>\r\n      ensureMediaPermissions().then(() =>\r\n        navigator.mediaDevices.enumerateDevices().then(devices => setDevices(devices))\r\n      );\r\n    navigator.mediaDevices.addEventListener('devicechange', getDevices);\r\n    getDevices();\r\n\r\n    return () => {\r\n      navigator.mediaDevices.removeEventListener('devicechange', getDevices);\r\n    };\r\n  }, []);\r\n\r\n  return devices;\r\n}\r\n\r\nexport function useAudioInputDevices() {\r\n  const devices = useDevices();\r\n  return devices.filter(device => device.kind === 'audioinput');\r\n}\r\n\r\nexport function useVideoInputDevices() {\r\n  const devices = useDevices();\r\n  return devices.filter(device => device.kind === 'videoinput');\r\n}\r\n\r\nexport function useAudioOutputDevices() {\r\n  const devices = useDevices();\r\n  return devices.filter(device => device.kind === 'audiooutput');\r\n}\r\n","import React from 'react';\r\nimport { FormControl, MenuItem, Typography, Select } from '@material-ui/core';\r\nimport LocalAudioLevelIndicator from '../LocalAudioLevelIndicator/LocalAudioLevelIndicator';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport { useAudioInputDevices } from '../deviceHooks/deviceHooks';\r\nimport useVideoContext from '../../../../hooks/useVideoContext/useVideoContext';\r\n\r\nconst useStyles = makeStyles({\r\n  container: {\r\n    display: 'flex',\r\n    alignItems: 'flex-end',\r\n    justifyContent: 'space-between',\r\n  },\r\n});\r\n\r\nexport default function AudioInputList() {\r\n  const classes = useStyles();\r\n  const audioInputDevices = useAudioInputDevices();\r\n  const {\r\n    room: { localParticipant },\r\n    localTracks,\r\n    getLocalAudioTrack,\r\n  } = useVideoContext();\r\n\r\n  const localAudioTrack = localTracks.find(track => track.kind === 'audio');\r\n  const localAudioInputDeviceId = localAudioTrack?.mediaStreamTrack.getSettings().deviceId;\r\n\r\n  function replaceTrack(newDeviceId: string) {\r\n    localAudioTrack?.stop();\r\n    getLocalAudioTrack(newDeviceId).then(newTrack => {\r\n      if (localAudioTrack) {\r\n        const localTrackPublication = localParticipant?.unpublishTrack(localAudioTrack);\r\n        // TODO: remove when SDK implements this event. See: https://issues.corp.twilio.com/browse/JSDK-2592\r\n        localParticipant?.emit('trackUnpublished', localTrackPublication);\r\n      }\r\n\r\n      localParticipant?.publishTrack(newTrack);\r\n    });\r\n  }\r\n\r\n  return (\r\n    <div className={classes.container}>\r\n      <div className=\"inputSelect\">\r\n        {audioInputDevices.length > 1 ? (\r\n          <FormControl fullWidth>\r\n            <Typography variant=\"h6\">Audio Input:</Typography>\r\n            <Select onChange={e => replaceTrack(e.target.value as string)} value={localAudioInputDeviceId || ''}>\r\n              {audioInputDevices.map(device => (\r\n                <MenuItem value={device.deviceId} key={device.deviceId}>\r\n                  {device.label}\r\n                </MenuItem>\r\n              ))}\r\n            </Select>\r\n          </FormControl>\r\n        ) : (\r\n          <>\r\n            <Typography variant=\"h6\">Audio Input:</Typography>\r\n            <Typography>{localAudioTrack?.mediaStreamTrack.label || 'No Local Audio'}</Typography>\r\n          </>\r\n        )}\r\n      </div>\r\n      <LocalAudioLevelIndicator />\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { FormControl, MenuItem, Typography, Select } from '@material-ui/core';\r\nimport { useAppState } from '../../../../state';\r\nimport { useAudioOutputDevices } from '../deviceHooks/deviceHooks';\r\n\r\nexport default function AudioOutputList() {\r\n  const audioOutputDevices = useAudioOutputDevices();\r\n  const { activeSinkId, setActiveSinkId } = useAppState();\r\n  const activeOutputLabel = audioOutputDevices.find(device => device.deviceId === activeSinkId)?.label;\r\n\r\n  return (\r\n    <div className=\"inputSelect\">\r\n      {audioOutputDevices.length > 1 ? (\r\n        <FormControl fullWidth>\r\n          <Typography variant=\"h6\">Audio Output:</Typography>\r\n          <Select onChange={e => setActiveSinkId(e.target.value as string)} value={activeSinkId}>\r\n            {audioOutputDevices.map(device => (\r\n              <MenuItem value={device.deviceId} key={device.deviceId}>\r\n                {device.label}\r\n              </MenuItem>\r\n            ))}\r\n          </Select>\r\n        </FormControl>\r\n      ) : (\r\n        <>\r\n          <Typography variant=\"h6\">Audio Output:</Typography>\r\n          <Typography>{activeOutputLabel || 'System Default Audio Output'}</Typography>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { FormControl, MenuItem, Typography, Select } from '@material-ui/core';\r\nimport { LocalVideoTrack } from 'twilio-video';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport useVideoContext from '../../../../hooks/useVideoContext/useVideoContext';\r\nimport { useVideoInputDevices } from '../deviceHooks/deviceHooks';\r\nimport VideoTrack from '../../../VideoTrack/VideoTrack';\r\n\r\nconst useStyles = makeStyles({\r\n  preview: {\r\n    width: '150px',\r\n    margin: '0.5em 0',\r\n  },\r\n});\r\n\r\nexport default function VideoInputList() {\r\n  const classes = useStyles();\r\n  const videoInputDevices = useVideoInputDevices();\r\n  const {\r\n    room: { localParticipant },\r\n    localTracks,\r\n    getLocalVideoTrack,\r\n  } = useVideoContext();\r\n\r\n  const localVideoTrack = localTracks.find(track => track.kind === 'video') as LocalVideoTrack;\r\n  const localVideoInputDeviceId = localVideoTrack?.mediaStreamTrack.getSettings().deviceId;\r\n\r\n  function replaceTrack(newDeviceId: string) {\r\n    localVideoTrack?.stop();\r\n    getLocalVideoTrack({ deviceId: { exact: newDeviceId } }).then(newTrack => {\r\n      if (localVideoTrack) {\r\n        const localTrackPublication = localParticipant?.unpublishTrack(localVideoTrack);\r\n        // TODO: remove when SDK implements this event. See: https://issues.corp.twilio.com/browse/JSDK-2592\r\n        localParticipant?.emit('trackUnpublished', localTrackPublication);\r\n      }\r\n\r\n      localParticipant?.publishTrack(newTrack);\r\n    });\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      {videoInputDevices.length > 1 ? (\r\n        <FormControl>\r\n          <Typography variant=\"h6\">Video Input:</Typography>\r\n          <Select onChange={e => replaceTrack(e.target.value as string)} value={localVideoInputDeviceId || ''}>\r\n            {videoInputDevices.map(device => (\r\n              <MenuItem value={device.deviceId} key={device.deviceId}>\r\n                {device.label}\r\n              </MenuItem>\r\n            ))}\r\n          </Select>\r\n        </FormControl>\r\n      ) : (\r\n        <>\r\n          <Typography variant=\"h6\">Video Input:</Typography>\r\n          <Typography>{localVideoTrack?.mediaStreamTrack.label || 'No Local Video'}</Typography>\r\n        </>\r\n      )}\r\n      {localVideoTrack && (\r\n        <div className={classes.preview}>\r\n          <VideoTrack isLocal track={localVideoTrack} />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState } from 'react';\r\n\r\nimport AudioInputList from './AudioInputList/AudioInputList';\r\nimport AudioOutputList from './AudioOutputList/AudioOutputList';\r\nimport { Dialog, IconButton, DialogContent, Button, Theme } from '@material-ui/core';\r\nimport SettingsIcon from '@material-ui/icons/Settings';\r\nimport VideoInputList from './VideoInputList/VideoInputList';\r\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    container: {\r\n      width: '500px',\r\n      [theme.breakpoints.down('xs')]: {\r\n        width: 'calc(100vw - 32px)',\r\n      },\r\n      '& .inputSelect': {\r\n        width: 'calc(100% - 35px)',\r\n      },\r\n    },\r\n    listSection: {\r\n      margin: '1em 0',\r\n    },\r\n    button: {\r\n      float: 'right',\r\n    },\r\n    paper: {\r\n      [theme.breakpoints.down('xs')]: {\r\n        margin: '16px',\r\n      },\r\n    },\r\n  })\r\n);\r\n\r\nexport function DeviceSelector() {\r\n  const classes = useStyles();\r\n  const [isOpen, setIsOpen] = useState(false);\r\n\r\n  return (\r\n    <>\r\n      <IconButton onClick={() => setIsOpen(true)} data-cy-device-select>\r\n        <SettingsIcon />\r\n      </IconButton>\r\n      <Dialog open={isOpen} onClose={() => setIsOpen(false)} classes={{ paper: classes.paper }}>\r\n        <DialogContent className={classes.container}>\r\n          <div className={classes.listSection}>\r\n            <AudioInputList />\r\n          </div>\r\n          <div className={classes.listSection}>\r\n            <AudioOutputList />\r\n          </div>\r\n          <div className={classes.listSection}>\r\n            <VideoInputList />\r\n          </div>\r\n          <Button className={classes.button} onClick={() => setIsOpen(false)}>\r\n            Done\r\n          </Button>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </>\r\n  );\r\n}\r\n","import React, { ChangeEvent, FormEvent, useState, useEffect } from 'react';\r\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\r\n\r\nimport AppBar from '@material-ui/core/AppBar';\r\nimport Button from '@material-ui/core/Button';\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\nimport TextField from '@material-ui/core/TextField';\r\nimport ToggleFullscreenButton from './ToggleFullScreenButton/ToggleFullScreenButton';\r\nimport Toolbar from '@material-ui/core/Toolbar';\r\nimport Menu from './Menu/Menu';\r\n\r\nimport { useAppState } from '../../state';\r\nimport { useParams } from 'react-router-dom';\r\nimport useRoomState from '../../hooks/useRoomState/useRoomState';\r\nimport useVideoContext from '../../hooks/useVideoContext/useVideoContext';\r\nimport { Typography } from '@material-ui/core';\r\nimport FlipCameraButton from './FlipCameraButton/FlipCameraButton';\r\nimport { DeviceSelector } from './DeviceSelector/DeviceSelector';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    container: {\r\n      backgroundColor: theme.palette.background.default,\r\n    },\r\n    toolbar: {\r\n      [theme.breakpoints.down('xs')]: {\r\n        padding: 0,\r\n      },\r\n    },\r\n    rightButtonContainer: {\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      marginLeft: 'auto',\r\n    },\r\n    form: {\r\n      display: 'flex',\r\n      flexWrap: 'wrap',\r\n      alignItems: 'center',\r\n      [theme.breakpoints.up('md')]: {\r\n        marginLeft: '2.2em',\r\n      },\r\n    },\r\n    textField: {\r\n      marginLeft: theme.spacing(1),\r\n      marginRight: theme.spacing(1),\r\n      maxWidth: 200,\r\n    },\r\n    loadingSpinner: {\r\n      marginLeft: '1em',\r\n    },\r\n    displayName: {\r\n      margin: '1.1em 0.6em',\r\n      minWidth: '200px',\r\n      fontWeight: 600,\r\n    },\r\n    joinButton: {\r\n      margin: '1em',\r\n    },\r\n  })\r\n);\r\n\r\nexport default function MenuBar() {\r\n  const classes = useStyles();\r\n  const { URLRoomName } = useParams();\r\n  const { user, getToken, isFetching } = useAppState();\r\n  const { isConnecting, connect } = useVideoContext();\r\n  const roomState = useRoomState();\r\n\r\n  const [name, setName] = useState<string>(user?.displayName || '');\r\n  const [roomName, setRoomName] = useState<string>('');\r\n\r\n  useEffect(() => {\r\n    if (URLRoomName) {\r\n      setRoomName(URLRoomName);\r\n    }\r\n  }, [URLRoomName]);\r\n\r\n  const handleNameChange = (event: ChangeEvent<HTMLInputElement>) => {\r\n    setName(event.target.value);\r\n  };\r\n\r\n  const handleRoomNameChange = (event: ChangeEvent<HTMLInputElement>) => {\r\n    setRoomName(event.target.value);\r\n  };\r\n\r\n  const handleSubmit = (event: FormEvent<HTMLFormElement>) => {\r\n    event.preventDefault();\r\n    // If this app is deployed as a twilio function, don't change the URL because routing isn't supported.\r\n    if (!window.location.origin.includes('twil.io')) {\r\n      window.history.replaceState(null, '', window.encodeURI(`/room/${roomName}${window.location.search || ''}`));\r\n    }\r\n    getToken(name, roomName).then(token => connect(token));\r\n  };\r\n\r\n  return (\r\n    <AppBar className={classes.container} position=\"static\">\r\n      <Toolbar className={classes.toolbar}>\r\n        {roomState === 'disconnected' ? (\r\n          <form className={classes.form} onSubmit={handleSubmit}>\r\n            {window.location.search.includes('customIdentity=true') || !user?.displayName ? (\r\n              <TextField\r\n                id=\"menu-name\"\r\n                label=\"Name\"\r\n                className={classes.textField}\r\n                value={name}\r\n                onChange={handleNameChange}\r\n                margin=\"dense\"\r\n              />\r\n            ) : (\r\n              <Typography className={classes.displayName} variant=\"body1\">\r\n                {user.displayName}\r\n              </Typography>\r\n            )}\r\n            <TextField\r\n              id=\"menu-room\"\r\n              label=\"Room\"\r\n              className={classes.textField}\r\n              value={roomName}\r\n              onChange={handleRoomNameChange}\r\n              margin=\"dense\"\r\n            />\r\n            <Button\r\n              className={classes.joinButton}\r\n              type=\"submit\"\r\n              color=\"primary\"\r\n              variant=\"contained\"\r\n              disabled={isConnecting || !name || !roomName || isFetching}\r\n            >\r\n              Join Room\r\n            </Button>\r\n            {(isConnecting || isFetching) && <CircularProgress className={classes.loadingSpinner} />}\r\n          </form>\r\n        ) : (\r\n          <h3>{roomName}</h3>\r\n        )}\r\n        <div className={classes.rightButtonContainer}>\r\n          <FlipCameraButton />\r\n          <DeviceSelector />\r\n          <ToggleFullscreenButton />\r\n          <Menu />\r\n        </div>\r\n      </Toolbar>\r\n    </AppBar>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\n\r\nimport InfoIcon from '@material-ui/icons/Info';\r\nimport Snackbar from '@material-ui/core/Snackbar';\r\nimport { SnackbarContent } from '@material-ui/core';\r\n\r\nimport useRoomState from '../../hooks/useRoomState/useRoomState';\r\n\r\nconst useStyles = makeStyles({\r\n  snackbar: {\r\n    backgroundColor: '#6db1ff',\r\n  },\r\n  message: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n  },\r\n  icon: {\r\n    marginRight: '0.8em',\r\n  },\r\n});\r\n\r\nexport default function ReconnectingNotification() {\r\n  const classes = useStyles();\r\n  const roomState = useRoomState();\r\n\r\n  return (\r\n    <Snackbar anchorOrigin={{ vertical: 'bottom', horizontal: 'right' }} open={roomState === 'reconnecting'}>\r\n      <SnackbarContent\r\n        className={classes.snackbar}\r\n        message={\r\n          <span className={classes.message}>\r\n            <InfoIcon className={classes.icon} />\r\n            Reconnecting&hellip;\r\n          </span>\r\n        }\r\n      />\r\n    </Snackbar>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { styled } from '@material-ui/core';\r\n\r\nimport ErrorOutlineIcon from '@material-ui/icons/ErrorOutline';\r\n\r\nconst BandwidthWarningContainer = styled('div')({\r\n  position: 'absolute',\r\n  zIndex: 1,\r\n  width: '100%',\r\n  display: 'flex',\r\n  flexDirection: 'column',\r\n  justifyContent: 'center',\r\n  alignItems: 'center',\r\n});\r\n\r\nconst Warning = styled('h3')({\r\n  textAlign: 'center',\r\n  margin: '0.6em 0',\r\n});\r\n\r\nexport default function BandwidthWarning() {\r\n  return (\r\n    <BandwidthWarningContainer>\r\n      <div>\r\n        <ErrorOutlineIcon fontSize=\"large\" />\r\n      </div>\r\n      <Warning>Insufficient Bandwidth</Warning>\r\n    </BandwidthWarningContainer>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { styled } from '@material-ui/core/styles';\r\n\r\nconst Container = styled('div')({\r\n  display: 'flex',\r\n  alignItems: 'flex-end',\r\n  '& div': {\r\n    width: '2px',\r\n    border: '1px solid black',\r\n    boxSizing: 'content-box',\r\n    '&:not(:last-child)': {\r\n      borderRight: 'none',\r\n    },\r\n  },\r\n});\r\n\r\nconst STEP = 3;\r\n\r\nexport default function NetworkQualityLevel({ qualityLevel }: { qualityLevel: number | null }) {\r\n  if (qualityLevel === null) return null;\r\n  return (\r\n    <Container>\r\n      {[0, 1, 2, 3, 4].map(level => (\r\n        <div\r\n          key={level}\r\n          style={{\r\n            height: `${STEP * (level + 1)}px`,\r\n            background: qualityLevel > level ? '#0c0' : '#040',\r\n          }}\r\n        />\r\n      ))}\r\n    </Container>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport clsx from 'clsx';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport { Participant } from 'twilio-video';\r\nimport useParticipantIsReconnecting from '../../../hooks/useParticipantIsReconnecting/useParticipantIsReconnecting';\r\nimport { Tooltip } from '@material-ui/core';\r\n\r\nconst useStyles = makeStyles({\r\n  indicator: {\r\n    width: '10px',\r\n    height: '10px',\r\n    borderRadius: '100%',\r\n    background: '#0c0',\r\n    display: 'inline-block',\r\n    marginRight: '3px',\r\n  },\r\n  isReconnecting: {\r\n    background: '#ffb100',\r\n  },\r\n});\r\n\r\nexport default function ParticipantConnectionIndicator({ participant }: { participant: Participant }) {\r\n  const isReconnecting = useParticipantIsReconnecting(participant);\r\n  const classes = useStyles();\r\n  return (\r\n    <Tooltip title={isReconnecting ? 'Participant is reconnecting' : 'Participant is connected'}>\r\n      <span className={clsx(classes.indicator, { [classes.isReconnecting]: isReconnecting })}></span>\r\n    </Tooltip>\r\n  );\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport { Participant } from 'twilio-video';\r\n\r\nexport default function useParticipantIsReconnecting(participant: Participant) {\r\n  const [isReconnecting, setIsReconnecting] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const handleReconnecting = () => setIsReconnecting(true);\r\n    const handleReconnected = () => setIsReconnecting(false);\r\n\r\n    participant.on('reconnecting', handleReconnecting);\r\n    participant.on('reconnected', handleReconnected);\r\n    return () => {\r\n      participant.off('reconnecting', handleReconnecting);\r\n      participant.off('reconnected', handleReconnected);\r\n    };\r\n  }, [participant]);\r\n\r\n  return isReconnecting;\r\n}\r\n","import React from 'react';\r\nimport { Pin } from '@primer/octicons-react';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\nimport SvgIcon from '@material-ui/core/SvgIcon';\r\n\r\nexport default function PinIcon() {\r\n  return (\r\n    <Tooltip title=\"Participant is pinned. Click to un-pin.\" placement=\"top\">\r\n      <SvgIcon style={{ float: 'right', fontSize: '29px' }}>\r\n        <Pin />\r\n      </SvgIcon>\r\n    </Tooltip>\r\n  );\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport { LocalTrackPublication, Participant, RemoteTrackPublication } from 'twilio-video';\r\n\r\ntype TrackPublication = LocalTrackPublication | RemoteTrackPublication;\r\n\r\nexport default function usePublications(participant: Participant) {\r\n  const [publications, setPublications] = useState<TrackPublication[]>([]);\r\n\r\n  useEffect(() => {\r\n    // Reset the publications when the 'participant' variable changes.\r\n    setPublications(Array.from(participant.tracks.values()) as TrackPublication[]);\r\n\r\n    const publicationAdded = (publication: TrackPublication) =>\r\n      setPublications(prevPublications => [...prevPublications, publication]);\r\n    const publicationRemoved = (publication: TrackPublication) =>\r\n      setPublications(prevPublications => prevPublications.filter(p => p !== publication));\r\n\r\n    participant.on('trackPublished', publicationAdded);\r\n    participant.on('trackUnpublished', publicationRemoved);\r\n    return () => {\r\n      participant.off('trackPublished', publicationAdded);\r\n      participant.off('trackUnpublished', publicationRemoved);\r\n    };\r\n  }, [participant]);\r\n\r\n  return publications;\r\n}\r\n","import { useState, useEffect } from 'react';\r\nimport { LocalVideoTrack, RemoteVideoTrack } from 'twilio-video';\r\n\r\ntype TrackType = RemoteVideoTrack | LocalVideoTrack | undefined | null;\r\n\r\n// The 'switchedOff' event is emitted when there is not enough bandwidth to support\r\n// a track. See: https://www.twilio.com/docs/video/tutorials/using-bandwidth-profile-api#understanding-track-switch-offs\r\n\r\nexport default function useIsTrackSwitchedOff(track: TrackType) {\r\n  const [isSwitchedOff, setIsSwitchedOff] = useState(track && track.isSwitchedOff);\r\n\r\n  useEffect(() => {\r\n    // Reset the value if the 'track' variable changes\r\n    setIsSwitchedOff(track && track.isSwitchedOff);\r\n\r\n    if (track) {\r\n      const handleSwitchedOff = () => setIsSwitchedOff(true);\r\n      const handleSwitchedOn = () => setIsSwitchedOff(false);\r\n      track.on('switchedOff', handleSwitchedOff);\r\n      track.on('switchedOn', handleSwitchedOn);\r\n      return () => {\r\n        track.off('switchedOff', handleSwitchedOff);\r\n        track.off('switchedOn', handleSwitchedOn);\r\n      };\r\n    }\r\n  }, [track]);\r\n\r\n  return !!isSwitchedOff;\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport { LocalTrackPublication, RemoteTrackPublication } from 'twilio-video';\r\n\r\nexport default function useTrack(publication: LocalTrackPublication | RemoteTrackPublication | undefined) {\r\n  const [track, setTrack] = useState(publication && publication.track);\r\n\r\n  useEffect(() => {\r\n    // Reset the track when the 'publication' variable changes.\r\n    setTrack(publication && publication.track);\r\n\r\n    if (publication) {\r\n      const removeTrack = () => setTrack(null);\r\n\r\n      publication.on('subscribed', setTrack);\r\n      publication.on('unsubscribed', removeTrack);\r\n      return () => {\r\n        publication.off('subscribed', setTrack);\r\n        publication.off('unsubscribed', removeTrack);\r\n      };\r\n    }\r\n  }, [publication]);\r\n\r\n  return track;\r\n}\r\n","import React from 'react';\r\nimport clsx from 'clsx';\r\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\r\nimport { LocalAudioTrack, LocalVideoTrack, Participant, RemoteAudioTrack, RemoteVideoTrack } from 'twilio-video';\r\n\r\nimport AudioLevelIndicator from '../AudioLevelIndicator/AudioLevelIndicator';\r\nimport BandwidthWarning from '../BandwidthWarning/BandwidthWarning';\r\nimport NetworkQualityLevel from '../NewtorkQualityLevel/NetworkQualityLevel';\r\nimport ParticipantConnectionIndicator from './ParticipantConnectionIndicator/ParticipantConnectionIndicator';\r\nimport PinIcon from './PinIcon/PinIcon';\r\nimport ScreenShare from '@material-ui/icons/ScreenShare';\r\nimport VideocamOff from '@material-ui/icons/VideocamOff';\r\n\r\nimport useParticipantNetworkQualityLevel from '../../hooks/useParticipantNetworkQualityLevel/useParticipantNetworkQualityLevel';\r\nimport usePublications from '../../hooks/usePublications/usePublications';\r\nimport useIsTrackSwitchedOff from '../../hooks/useIsTrackSwitchedOff/useIsTrackSwitchedOff';\r\nimport useTrack from '../../hooks/useTrack/useTrack';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    container: {\r\n      position: 'relative',\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      height: `${(theme.sidebarWidth * 9) / 16}px`,\r\n      overflow: 'hidden',\r\n      cursor: 'pointer',\r\n      '& video': {\r\n        filter: 'none',\r\n      },\r\n      '& svg': {\r\n        stroke: 'black',\r\n        strokeWidth: '0.8px',\r\n      },\r\n      [theme.breakpoints.down('xs')]: {\r\n        height: theme.sidebarMobileHeight,\r\n        width: `${(theme.sidebarMobileHeight * 16) / 9}px`,\r\n        marginRight: '3px',\r\n        fontSize: '10px',\r\n      },\r\n    },\r\n    isVideoSwitchedOff: {\r\n      '& video': {\r\n        filter: 'blur(4px) grayscale(1) brightness(0.5)',\r\n      },\r\n    },\r\n    infoContainer: {\r\n      position: 'absolute',\r\n      zIndex: 1,\r\n      display: 'flex',\r\n      flexDirection: 'column',\r\n      justifyContent: 'space-between',\r\n      height: '100%',\r\n      padding: '0.4em',\r\n      width: '100%',\r\n      background: 'transparent',\r\n    },\r\n    hideVideo: {\r\n      background: 'black',\r\n    },\r\n    identity: {\r\n      background: 'rgba(0, 0, 0, 0.7)',\r\n      padding: '0.1em 0.3em',\r\n      margin: 0,\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n    },\r\n    infoRow: {\r\n      display: 'flex',\r\n      justifyContent: 'space-between',\r\n    },\r\n  })\r\n);\r\n\r\ninterface ParticipantInfoProps {\r\n  participant: Participant;\r\n  children: React.ReactNode;\r\n  onClick: () => void;\r\n  isSelected: boolean;\r\n}\r\n\r\nexport default function ParticipantInfo({ participant, onClick, isSelected, children }: ParticipantInfoProps) {\r\n  const publications = usePublications(participant);\r\n\r\n  const audioPublication = publications.find(p => p.kind === 'audio');\r\n  const videoPublication = publications.find(p => p.trackName.includes('camera'));\r\n\r\n  const networkQualityLevel = useParticipantNetworkQualityLevel(participant);\r\n  const isVideoEnabled = Boolean(videoPublication);\r\n  const isScreenShareEnabled = publications.find(p => p.trackName.includes('screen'));\r\n\r\n  const videoTrack = useTrack(videoPublication);\r\n  const isVideoSwitchedOff = useIsTrackSwitchedOff(videoTrack as LocalVideoTrack | RemoteVideoTrack);\r\n\r\n  const audioTrack = useTrack(audioPublication) as LocalAudioTrack | RemoteAudioTrack;\r\n\r\n  const classes = useStyles();\r\n\r\n  return (\r\n    <div\r\n      className={clsx(classes.container, {\r\n        [classes.isVideoSwitchedOff]: isVideoSwitchedOff,\r\n      })}\r\n      onClick={onClick}\r\n      data-cy-participant={participant.identity}\r\n    >\r\n      <div className={clsx(classes.infoContainer, { [classes.hideVideo]: !isVideoEnabled })}>\r\n        <div className={classes.infoRow}>\r\n          <h4 className={classes.identity}>\r\n            <ParticipantConnectionIndicator participant={participant} />\r\n            {participant.identity}\r\n          </h4>\r\n          <NetworkQualityLevel qualityLevel={networkQualityLevel} />\r\n        </div>\r\n        <div>\r\n          <AudioLevelIndicator audioTrack={audioTrack} background=\"white\" />\r\n          {!isVideoEnabled && <VideocamOff />}\r\n          {isScreenShareEnabled && <ScreenShare />}\r\n          {isSelected && <PinIcon />}\r\n        </div>\r\n      </div>\r\n      {isVideoSwitchedOff && <BandwidthWarning />}\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport { Participant } from 'twilio-video';\r\n\r\nexport default function useParticipantNetworkQualityLevel(participant: Participant) {\r\n  const [networkQualityLevel, setNetworkQualityLevel] = useState(participant.networkQualityLevel);\r\n\r\n  useEffect(() => {\r\n    const handleNewtorkQualityLevelChange = (newNetworkQualityLevel: number) =>\r\n      setNetworkQualityLevel(newNetworkQualityLevel);\r\n\r\n    setNetworkQualityLevel(participant.networkQualityLevel);\r\n    participant.on('networkQualityLevelChanged', handleNewtorkQualityLevelChange);\r\n    return () => {\r\n      participant.off('networkQualityLevelChanged', handleNewtorkQualityLevelChange);\r\n    };\r\n  }, [participant]);\r\n\r\n  return networkQualityLevel;\r\n}\r\n","import { useEffect, useRef } from 'react';\r\nimport { AudioTrack as IAudioTrack } from 'twilio-video';\r\nimport { useAppState } from '../../state';\r\n\r\ninterface AudioTrackProps {\r\n  track: IAudioTrack;\r\n}\r\n\r\nexport default function AudioTrack({ track }: AudioTrackProps) {\r\n  const { activeSinkId } = useAppState();\r\n  const audioEl = useRef<HTMLAudioElement>();\r\n\r\n  useEffect(() => {\r\n    audioEl.current = track.attach();\r\n    audioEl.current.setAttribute('data-cy-audio-track-name', track.name);\r\n    document.body.appendChild(audioEl.current);\r\n    return () => track.detach().forEach(el => el.remove());\r\n  }, [track]);\r\n\r\n  useEffect(() => {\r\n    audioEl.current?.setSinkId?.(activeSinkId);\r\n  }, [activeSinkId]);\r\n\r\n  return null;\r\n}\r\n","import React from 'react';\r\nimport useTrack from '../../hooks/useTrack/useTrack';\r\nimport AudioTrack from '../AudioTrack/AudioTrack';\r\nimport VideoTrack from '../VideoTrack/VideoTrack';\r\n\r\nimport { IVideoTrack } from '../../types';\r\nimport {\r\n  AudioTrack as IAudioTrack,\r\n  LocalTrackPublication,\r\n  Participant,\r\n  RemoteTrackPublication,\r\n  Track,\r\n} from 'twilio-video';\r\n\r\ninterface PublicationProps {\r\n  publication: LocalTrackPublication | RemoteTrackPublication;\r\n  participant: Participant;\r\n  isLocal: boolean;\r\n  disableAudio?: boolean;\r\n  videoPriority?: Track.Priority | null;\r\n}\r\n\r\nexport default function Publication({ publication, isLocal, disableAudio, videoPriority }: PublicationProps) {\r\n  const track = useTrack(publication);\r\n\r\n  if (!track) return null;\r\n\r\n  switch (track.kind) {\r\n    case 'video':\r\n      return (\r\n        <VideoTrack\r\n          track={track as IVideoTrack}\r\n          priority={videoPriority}\r\n          isLocal={track.name.includes('camera') && isLocal}\r\n        />\r\n      );\r\n    case 'audio':\r\n      return disableAudio ? null : <AudioTrack track={track as IAudioTrack} />;\r\n    default:\r\n      return null;\r\n  }\r\n}\r\n","import React from 'react';\r\nimport { Participant, Track } from 'twilio-video';\r\nimport Publication from '../Publication/Publication';\r\nimport usePublications from '../../hooks/usePublications/usePublications';\r\nimport useVideoContext from '../../hooks/useVideoContext/useVideoContext';\r\n\r\ninterface ParticipantTracksProps {\r\n  participant: Participant;\r\n  disableAudio?: boolean;\r\n  enableScreenShare?: boolean;\r\n  videoPriority?: Track.Priority | null;\r\n}\r\n\r\n/*\r\n *  The object model for the Room object (found here: https://www.twilio.com/docs/video/migrating-1x-2x#object-model) shows\r\n *  that Participant objects have TrackPublications, and TrackPublication objects have Tracks.\r\n *\r\n *  The React components in this application follow the same pattern. This ParticipantTracks component renders Publications,\r\n *  and the Publication component renders Tracks.\r\n */\r\n\r\nexport default function ParticipantTracks({\r\n  participant,\r\n  disableAudio,\r\n  enableScreenShare,\r\n  videoPriority,\r\n}: ParticipantTracksProps) {\r\n  const { room } = useVideoContext();\r\n  const publications = usePublications(participant);\r\n  const isLocal = participant === room.localParticipant;\r\n\r\n  let filteredPublications;\r\n\r\n  if (enableScreenShare && publications.some(p => p.trackName.includes('screen'))) {\r\n    filteredPublications = publications.filter(p => !p.trackName.includes('camera'));\r\n  } else {\r\n    filteredPublications = publications.filter(p => !p.trackName.includes('screen'));\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {filteredPublications.map(publication => (\r\n        <Publication\r\n          key={publication.kind}\r\n          publication={publication}\r\n          participant={participant}\r\n          isLocal={isLocal}\r\n          disableAudio={disableAudio}\r\n          videoPriority={videoPriority}\r\n        />\r\n      ))}\r\n    </>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport ParticipantInfo from '../ParticipantInfo/ParticipantInfo';\r\nimport ParticipantTracks from '../ParticipantTracks/ParticipantTracks';\r\nimport { Participant as IParticipant } from 'twilio-video';\r\n\r\ninterface ParticipantProps {\r\n  participant: IParticipant;\r\n  disableAudio?: boolean;\r\n  enableScreenShare?: boolean;\r\n  onClick: () => void;\r\n  isSelected: boolean;\r\n}\r\n\r\nexport default function Participant({\r\n  participant,\r\n  disableAudio,\r\n  enableScreenShare,\r\n  onClick,\r\n  isSelected,\r\n}: ParticipantProps) {\r\n  return (\r\n    <ParticipantInfo participant={participant} onClick={onClick} isSelected={isSelected}>\r\n      <ParticipantTracks participant={participant} disableAudio={disableAudio} enableScreenShare={enableScreenShare} />\r\n    </ParticipantInfo>\r\n  );\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport useVideoContext from '../useVideoContext/useVideoContext';\r\nimport { RemoteParticipant } from 'twilio-video';\r\n\r\nexport default function useDominantSpeaker() {\r\n  const { room } = useVideoContext();\r\n  const [dominantSpeaker, setDominantSpeaker] = useState(room.dominantSpeaker);\r\n\r\n  useEffect(() => {\r\n    // Sometimes, the 'dominantSpeakerChanged' event can emit 'null', which means that\r\n    // there is no dominant speaker. If we change the main participant when 'null' is\r\n    // emitted, the effect can be jarring to the user. Here we ignore any 'null' values\r\n    // and continue to display the previous dominant speaker as the main participant.\r\n    const handleDominantSpeakerChanged = (newDominantSpeaker: RemoteParticipant) => {\r\n      if (newDominantSpeaker !== null) {\r\n        setDominantSpeaker(newDominantSpeaker);\r\n      }\r\n    };\r\n\r\n    // Since 'null' values are ignored, we will need to listen for the 'participantDisconnected'\r\n    // event, so we can set the dominantSpeaker to 'null' when they disconnect.\r\n    const handleParticipantDisconnected = (participant: RemoteParticipant) => {\r\n      setDominantSpeaker(prevDominantSpeaker => {\r\n        return prevDominantSpeaker === participant ? null : prevDominantSpeaker;\r\n      });\r\n    };\r\n\r\n    room.on('dominantSpeakerChanged', handleDominantSpeakerChanged);\r\n    room.on('participantDisconnected', handleParticipantDisconnected);\r\n    return () => {\r\n      room.off('dominantSpeakerChanged', handleDominantSpeakerChanged);\r\n      room.off('participantDisconnected', handleParticipantDisconnected);\r\n    };\r\n  }, [room]);\r\n\r\n  return dominantSpeaker;\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport { RemoteParticipant } from 'twilio-video';\r\nimport useDominantSpeaker from '../useDominantSpeaker/useDominantSpeaker';\r\nimport useVideoContext from '../useVideoContext/useVideoContext';\r\n\r\nexport default function useParticipants() {\r\n  const { room } = useVideoContext();\r\n  const dominantSpeaker = useDominantSpeaker();\r\n  const [participants, setParticipants] = useState(Array.from(room.participants.values()));\r\n\r\n  // When the dominant speaker changes, they are moved to the front of the participants array.\r\n  // This means that the most recent dominant speakers will always be near the top of the\r\n  // ParticipantStrip component.\r\n  useEffect(() => {\r\n    if (dominantSpeaker) {\r\n      setParticipants(prevParticipants => [\r\n        dominantSpeaker,\r\n        ...prevParticipants.filter(participant => participant !== dominantSpeaker),\r\n      ]);\r\n    }\r\n  }, [dominantSpeaker]);\r\n\r\n  useEffect(() => {\r\n    const participantConnected = (participant: RemoteParticipant) =>\r\n      setParticipants(prevParticipants => [...prevParticipants, participant]);\r\n    const participantDisconnected = (participant: RemoteParticipant) =>\r\n      setParticipants(prevParticipants => prevParticipants.filter(p => p !== participant));\r\n    room.on('participantConnected', participantConnected);\r\n    room.on('participantDisconnected', participantDisconnected);\r\n    return () => {\r\n      room.off('participantConnected', participantConnected);\r\n      room.off('participantDisconnected', participantDisconnected);\r\n    };\r\n  }, [room]);\r\n\r\n  return participants;\r\n}\r\n","import React from 'react';\r\nimport Participant from '../Participant/Participant';\r\nimport { styled } from '@material-ui/core/styles';\r\nimport useParticipants from '../../hooks/useParticipants/useParticipants';\r\nimport useVideoContext from '../../hooks/useVideoContext/useVideoContext';\r\nimport useSelectedParticipant from '../VideoProvider/useSelectedParticipant/useSelectedParticipant';\r\n\r\nconst Container = styled('aside')(({ theme }) => ({\r\n  padding: '0.5em',\r\n  overflowY: 'auto',\r\n  [theme.breakpoints.down('xs')]: {\r\n    overflowY: 'initial',\r\n    overflowX: 'auto',\r\n    padding: 0,\r\n    display: 'flex',\r\n  },\r\n}));\r\n\r\nconst ScrollContainer = styled('div')(({ theme }) => ({\r\n  [theme.breakpoints.down('xs')]: {\r\n    display: 'flex',\r\n  },\r\n}));\r\n\r\nexport default function ParticipantStrip() {\r\n  const {\r\n    room: { localParticipant },\r\n  } = useVideoContext();\r\n  const participants = useParticipants();\r\n  const [selectedParticipant, setSelectedParticipant] = useSelectedParticipant();\r\n\r\n  return (\r\n    <Container>\r\n      <ScrollContainer>\r\n        <Participant\r\n          participant={localParticipant}\r\n          isSelected={selectedParticipant === localParticipant}\r\n          onClick={() => setSelectedParticipant(localParticipant)}\r\n        />\r\n        {participants.map(participant => (\r\n          <Participant\r\n            key={participant.sid}\r\n            participant={participant}\r\n            isSelected={selectedParticipant === participant}\r\n            onClick={() => setSelectedParticipant(participant)}\r\n          />\r\n        ))}\r\n      </ScrollContainer>\r\n    </Container>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport clsx from 'clsx';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport { LocalVideoTrack, Participant, RemoteVideoTrack } from 'twilio-video';\r\n\r\nimport BandwidthWarning from '../BandwidthWarning/BandwidthWarning';\r\nimport useIsTrackSwitchedOff from '../../hooks/useIsTrackSwitchedOff/useIsTrackSwitchedOff';\r\nimport usePublications from '../../hooks/usePublications/usePublications';\r\nimport useTrack from '../../hooks/useTrack/useTrack';\r\nimport VideocamOff from '@material-ui/icons/VideocamOff';\r\n\r\nconst useStyles = makeStyles({\r\n  container: {\r\n    position: 'relative',\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    gridArea: 'participantList',\r\n  },\r\n  isVideoSwitchedOff: {\r\n    '& video': {\r\n      filter: 'blur(4px) grayscale(1) brightness(0.5)',\r\n    },\r\n  },\r\n  identity: {\r\n    background: 'rgba(0, 0, 0, 0.7)',\r\n    padding: '0.1em 0.3em',\r\n    margin: '1em',\r\n    fontSize: '1.2em',\r\n    display: 'inline-flex',\r\n    '& svg': {\r\n      marginLeft: '0.3em',\r\n    },\r\n  },\r\n  infoContainer: {\r\n    position: 'absolute',\r\n    zIndex: 1,\r\n    height: '100%',\r\n    padding: '0.4em',\r\n    width: '100%',\r\n  },\r\n});\r\n\r\ninterface MainParticipantInfoProps {\r\n  participant: Participant;\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport default function MainParticipantInfo({ participant, children }: MainParticipantInfoProps) {\r\n  const classes = useStyles();\r\n\r\n  const publications = usePublications(participant);\r\n  const videoPublication = publications.find(p => p.trackName.includes('camera'));\r\n  const screenSharePublication = publications.find(p => p.trackName.includes('screen'));\r\n  const isVideoEnabled = Boolean(videoPublication);\r\n\r\n  const videoTrack = useTrack(screenSharePublication || videoPublication);\r\n  const isVideoSwitchedOff = useIsTrackSwitchedOff(videoTrack as LocalVideoTrack | RemoteVideoTrack);\r\n\r\n  return (\r\n    <div\r\n      data-cy-main-participant\r\n      className={clsx(classes.container, { [classes.isVideoSwitchedOff]: isVideoSwitchedOff })}\r\n    >\r\n      <div className={classes.infoContainer}>\r\n        <h4 className={classes.identity}>\r\n          {participant.identity}\r\n          {!isVideoEnabled && <VideocamOff />}\r\n        </h4>\r\n      </div>\r\n      {isVideoSwitchedOff && <BandwidthWarning />}\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n","import MainParticipantInfo from '../MainParticipantInfo/MainParticipantInfo';\r\nimport ParticipantTracks from '../ParticipantTracks/ParticipantTracks';\r\nimport React from 'react';\r\nimport useMainSpeaker from '../../hooks/useMainSpeaker/useMainSpeaker';\r\nimport useSelectedParticipant from '../VideoProvider/useSelectedParticipant/useSelectedParticipant';\r\nimport useScreenShareParticipant from '../../hooks/useScreenShareParticipant/useScreenShareParticipant';\r\n\r\nexport default function MainParticipant() {\r\n  const mainParticipant = useMainSpeaker();\r\n  const [selectedParticipant] = useSelectedParticipant();\r\n  const screenShareParticipant = useScreenShareParticipant();\r\n\r\n  const videoPriority =\r\n    mainParticipant === selectedParticipant || mainParticipant === screenShareParticipant ? 'high' : null;\r\n\r\n  return (\r\n    /* audio is disabled for this participant component because this participant's audio \r\n       is already being rendered in the <ParticipantStrip /> component.  */\r\n    <MainParticipantInfo participant={mainParticipant}>\r\n      <ParticipantTracks participant={mainParticipant} disableAudio enableScreenShare videoPriority={videoPriority} />\r\n    </MainParticipantInfo>\r\n  );\r\n}\r\n","import useVideoContext from '../useVideoContext/useVideoContext';\r\nimport useDominantSpeaker from '../useDominantSpeaker/useDominantSpeaker';\r\nimport useParticipants from '../useParticipants/useParticipants';\r\nimport useScreenShareParticipant from '../useScreenShareParticipant/useScreenShareParticipant';\r\nimport useSelectedParticipant from '../../components/VideoProvider/useSelectedParticipant/useSelectedParticipant';\r\n\r\nexport default function useMainSpeaker() {\r\n  const [selectedParticipant] = useSelectedParticipant();\r\n  const screenShareParticipant = useScreenShareParticipant();\r\n  const dominantSpeaker = useDominantSpeaker();\r\n  const participants = useParticipants();\r\n  const {\r\n    room: { localParticipant },\r\n  } = useVideoContext();\r\n\r\n  // The participant that is returned is displayed in the main video area. Changing the order of the following\r\n  // variables will change the how the main speaker is determined.\r\n  return selectedParticipant || screenShareParticipant || dominantSpeaker || participants[0] || localParticipant;\r\n}\r\n","import React from 'react';\r\nimport ParticipantStrip from '../ParticipantStrip/ParticipantStrip';\r\nimport { styled } from '@material-ui/core/styles';\r\nimport MainParticipant from '../MainParticipant/MainParticipant';\r\n\r\nconst Container = styled('div')(({ theme }) => ({\r\n  position: 'relative',\r\n  height: '100%',\r\n  display: 'grid',\r\n  gridTemplateColumns: `${theme.sidebarWidth}px 1fr`,\r\n  gridTemplateAreas: '\". participantList\"',\r\n  gridTemplateRows: '100%',\r\n  [theme.breakpoints.down('xs')]: {\r\n    gridTemplateAreas: '\"participantList\" \".\"',\r\n    gridTemplateColumns: `auto`,\r\n    gridTemplateRows: `calc(100% - ${theme.sidebarMobileHeight + 12}px) ${theme.sidebarMobileHeight + 6}px`,\r\n    gridGap: '6px',\r\n  },\r\n}));\r\n\r\nexport default function Room() {\r\n  return (\r\n    <Container>\r\n      <ParticipantStrip />\r\n      <MainParticipant />\r\n    </Container>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { styled } from '@material-ui/core/styles';\r\n\r\nimport Controls from './components/Controls/Controls';\r\nimport LocalVideoPreview from './components/LocalVideoPreview/LocalVideoPreview';\r\nimport MenuBar from './components/MenuBar/MenuBar';\r\nimport ReconnectingNotification from './components/ReconnectingNotification/ReconnectingNotification';\r\nimport Room from './components/Room/Room';\r\n\r\nimport useHeight from './hooks/useHeight/useHeight';\r\nimport useRoomState from './hooks/useRoomState/useRoomState';\r\n\r\nconst Container = styled('div')({\r\n  display: 'grid',\r\n  gridTemplateRows: 'auto 1fr',\r\n});\r\n\r\nconst Main = styled('main')({\r\n  overflow: 'hidden',\r\n});\r\n\r\nexport default function App() {\r\n  const roomState = useRoomState();\r\n\r\n  // Here we would like the height of the main container to be the height of the viewport.\r\n  // On some mobile browsers, 'height: 100vh' sets the height equal to that of the screen,\r\n  // not the viewport. This looks bad when the mobile browsers location bar is open.\r\n  // We will dynamically set the height with 'window.innerHeight', which means that this\r\n  // will look good on mobile browsers even after the location bar opens or closes.\r\n  const height = useHeight();\r\n\r\n  return (\r\n    <Container style={{ height }}>\r\n      <MenuBar />\r\n      <Main>\r\n        {roomState === 'disconnected' ? <LocalVideoPreview /> : <Room />}\r\n        <Controls />\r\n      </Main>\r\n      <ReconnectingNotification />\r\n    </Container>\r\n  );\r\n}\r\n","import { useEffect, useState } from 'react';\r\n\r\nexport default function useHeight() {\r\n  const [height, setHeight] = useState(window.innerHeight * (window.visualViewport?.scale || 1));\r\n\r\n  useEffect(() => {\r\n    const onResize = () => {\r\n      setHeight(window.innerHeight * (window.visualViewport?.scale || 1));\r\n    };\r\n\r\n    window.addEventListener('resize', onResize);\r\n    return () => {\r\n      window.removeEventListener('resize', onResize);\r\n    };\r\n  });\r\n\r\n  return height + 'px';\r\n}\r\n","import React, { PropsWithChildren } from 'react';\r\nimport Button from '@material-ui/core/Button';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport DialogActions from '@material-ui/core/DialogActions';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\nimport DialogContentText from '@material-ui/core/DialogContentText';\r\nimport enhanceMessage from './enhanceMessage';\r\nimport { TwilioError } from 'twilio-video';\r\n\r\ninterface ErrorDialogProps {\r\n  dismissError: Function;\r\n  error: TwilioError | null;\r\n}\r\n\r\nfunction ErrorDialog({ dismissError, error }: PropsWithChildren<ErrorDialogProps>) {\r\n  const { message, code } = error || {};\r\n  const enhancedMessage = enhanceMessage(message, code);\r\n\r\n  return (\r\n    <Dialog open={error !== null} onClose={() => dismissError()} fullWidth={true} maxWidth=\"xs\">\r\n      <DialogTitle>ERROR</DialogTitle>\r\n      <DialogContent>\r\n        <DialogContentText>{enhancedMessage}</DialogContentText>\r\n        {code && (\r\n          <pre>\r\n            <code>Error Code: {code}</code>\r\n          </pre>\r\n        )}\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={() => dismissError()} color=\"primary\" autoFocus>\r\n          OK\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  );\r\n}\r\n\r\nexport default ErrorDialog;\r\n","// This function is used to provide error messages to the user that are\r\n// different than the error messages provided by the SDK.\r\nexport default function enhanceMessage(message = '', code?: number) {\r\n  switch (code) {\r\n    case 20101: // Invalid token error\r\n      return message + '. Please make sure you are using the correct credentials.';\r\n    default:\r\n      return message;\r\n  }\r\n}\r\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"title\", null, \"btn_google_light_normal_ios\");\n\nvar _ref3 = /*#__PURE__*/React.createElement(\"desc\", null, \"Created with Sketch.\");\n\nvar _ref4 = /*#__PURE__*/React.createElement(\"defs\", null, /*#__PURE__*/React.createElement(\"filter\", {\n  x: \"-50%\",\n  y: \"-50%\",\n  width: \"200%\",\n  height: \"200%\",\n  filterUnits: \"objectBoundingBox\",\n  id: \"filter-1\"\n}, /*#__PURE__*/React.createElement(\"feOffset\", {\n  dx: 0,\n  dy: 1,\n  in: \"SourceAlpha\",\n  result: \"shadowOffsetOuter1\"\n}), /*#__PURE__*/React.createElement(\"feGaussianBlur\", {\n  stdDeviation: 0.5,\n  in: \"shadowOffsetOuter1\",\n  result: \"shadowBlurOuter1\"\n}), /*#__PURE__*/React.createElement(\"feColorMatrix\", {\n  values: \"0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.168 0\",\n  in: \"shadowBlurOuter1\",\n  type: \"matrix\",\n  result: \"shadowMatrixOuter1\"\n}), /*#__PURE__*/React.createElement(\"feOffset\", {\n  dx: 0,\n  dy: 0,\n  in: \"SourceAlpha\",\n  result: \"shadowOffsetOuter2\"\n}), /*#__PURE__*/React.createElement(\"feGaussianBlur\", {\n  stdDeviation: 0.5,\n  in: \"shadowOffsetOuter2\",\n  result: \"shadowBlurOuter2\"\n}), /*#__PURE__*/React.createElement(\"feColorMatrix\", {\n  values: \"0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.084 0\",\n  in: \"shadowBlurOuter2\",\n  type: \"matrix\",\n  result: \"shadowMatrixOuter2\"\n}), /*#__PURE__*/React.createElement(\"feMerge\", null, /*#__PURE__*/React.createElement(\"feMergeNode\", {\n  in: \"shadowMatrixOuter1\"\n}), /*#__PURE__*/React.createElement(\"feMergeNode\", {\n  in: \"shadowMatrixOuter2\"\n}), /*#__PURE__*/React.createElement(\"feMergeNode\", {\n  in: \"SourceGraphic\"\n}))), /*#__PURE__*/React.createElement(\"rect\", {\n  id: \"path-2\",\n  x: 0,\n  y: 0,\n  width: 40,\n  height: 40,\n  rx: 2\n}));\n\nvar _ref5 = /*#__PURE__*/React.createElement(\"g\", {\n  id: \"Google-Button\",\n  stroke: \"none\",\n  strokeWidth: 1,\n  fill: \"none\",\n  fillRule: \"evenodd\"\n}, /*#__PURE__*/React.createElement(\"g\", {\n  id: \"9-PATCH\",\n  transform: \"translate(-608.000000, -160.000000)\"\n}), /*#__PURE__*/React.createElement(\"g\", {\n  id: \"btn_google_light_normal\",\n  transform: \"translate(-1.000000, -1.000000)\"\n}, /*#__PURE__*/React.createElement(\"g\", {\n  id: \"logo_googleg_48dp\",\n  transform: \"translate(15.000000, 15.000000)\"\n}, /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M17.64,9.20454545 C17.64,8.56636364 17.5827273,7.95272727 17.4763636,7.36363636 L9,7.36363636 L9,10.845 L13.8436364,10.845 C13.635,11.97 13.0009091,12.9231818 12.0477273,13.5613636 L12.0477273,15.8195455 L14.9563636,15.8195455 C16.6581818,14.2527273 17.64,11.9454545 17.64,9.20454545 L17.64,9.20454545 Z\",\n  id: \"Shape\",\n  fill: \"#4285F4\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M9,18 C11.43,18 13.4672727,17.1940909 14.9563636,15.8195455 L12.0477273,13.5613636 C11.2418182,14.1013636 10.2109091,14.4204545 9,14.4204545 C6.65590909,14.4204545 4.67181818,12.8372727 3.96409091,10.71 L0.957272727,10.71 L0.957272727,13.0418182 C2.43818182,15.9831818 5.48181818,18 9,18 L9,18 Z\",\n  id: \"Shape\",\n  fill: \"#34A853\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M3.96409091,10.71 C3.78409091,10.17 3.68181818,9.59318182 3.68181818,9 C3.68181818,8.40681818 3.78409091,7.83 3.96409091,7.29 L3.96409091,4.95818182 L0.957272727,4.95818182 C0.347727273,6.17318182 0,7.54772727 0,9 C0,10.4522727 0.347727273,11.8268182 0.957272727,13.0418182 L3.96409091,10.71 L3.96409091,10.71 Z\",\n  id: \"Shape\",\n  fill: \"#FBBC05\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M9,3.57954545 C10.3213636,3.57954545 11.5077273,4.03363636 12.4404545,4.92545455 L15.0218182,2.34409091 C13.4631818,0.891818182 11.4259091,0 9,0 C5.48181818,0 2.43818182,2.01681818 0.957272727,4.95818182 L3.96409091,7.29 C4.67181818,5.16272727 6.65590909,3.57954545 9,3.57954545 L9,3.57954545 Z\",\n  id: \"Shape\",\n  fill: \"#EA4335\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M0,0 L18,0 L18,18 L0,18 L0,0 Z\",\n  id: \"Shape\"\n})), /*#__PURE__*/React.createElement(\"g\", {\n  id: \"handles_square\"\n})));\n\nvar SvgGoogleLogo = function SvgGoogleLogo(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: \"32px\",\n    height: \"32px\",\n    viewBox: \"7 7 32 32\",\n    ref: svgRef\n  }, props), title === undefined ? _ref2 : title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref3, _ref4, _ref5);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgGoogleLogo, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/google-logo.06c50bce.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M14.4 11.3c0 1.7-1.4 3.1-3.1 3.1S8.2 13 8.2 11.3s1.4-3.1 3.1-3.1 3.1 1.4 3.1 3.1zm-3.1 4.3c-1.7 0-3.1 1.4-3.1 3.1s1.4 3.1 3.1 3.1 3.1-1.4 3.1-3.1-1.4-3.1-3.1-3.1zM30 15c0 8.3-6.7 15-15 15S0 23.3 0 15 6.7 0 15 0s15 6.7 15 15zm-4 0c0-6.1-4.9-11-11-11S4 8.9 4 15s4.9 11 11 11 11-4.9 11-11zm-7.3.6c-1.7 0-3.1 1.4-3.1 3.1s1.4 3.1 3.1 3.1 3.1-1.4 3.1-3.1-1.4-3.1-3.1-3.1zm0-7.4c-1.7 0-3.1 1.4-3.1 3.1s1.4 3.1 3.1 3.1 3.1-1.4 3.1-3.1-1.4-3.1-3.1-3.1zm51.6-2.3c.1 0 .2.1.3.2v3.2c0 .2-.2.3-.3.3H65c-.2 0-.3-.2-.3-.3V6.2c0-.2.2-.3.3-.3h5.3zm-.1 4.5H60c-.1 0-.3.1-.3.3l-1.3 5-.1.3-1.6-5.3c0-.1-.2-.3-.3-.3h-4c-.1 0-.3.1-.3.3l-1.5 5-.1.3-.1-.3-.6-2.5-.6-2.5c0-.1-.2-.3-.3-.3h-8V6.1c0-.1-.2-.3-.4-.2l-5 1.6c-.2 0-.3.1-.3.3v2.7h-1.3c-.1 0-.3.1-.3.3v3.8c0 .1.1.3.3.3h1.3v4.7c0 3.3 1.8 4.8 5.1 4.8 1.4 0 2.7-.3 3.6-.8v-4c0-.2-.2-.3-.3-.2-.5.2-1 .3-1.4.3-.9 0-1.4-.4-1.4-1.4v-3.4h2.9c.1 0 .3-.1.3-.3v-3.2L47.8 24c0 .1.2.3.3.3h4.2c.1 0 .3-.1.3-.3l1.8-5.6.9 2.9.8 2.7c0 .1.2.3.3.3h4.2c.1 0 .3-.1.3-.3l3.8-12.6V24c0 .1.1.3.3.3h5.1c.1 0 .3-.1.3-.3V10.7c0-.1-.1-.3-.2-.3zm6.7-4.5h-5.1c-.1 0-.3.1-.3.3v17.7c0 .1.1.3.3.3h5.1c.1 0 .3-.1.3-.3V6.1c0-.1-.1-.2-.3-.2zm6.8 0h-5.3c-.1 0-.3.1-.3.3v3.1c0 .1.1.3.3.3h5.3c.1 0 .3-.1.3-.3V6.1c0-.1-.1-.2-.3-.2zm-.1 4.5h-5.1c-.1 0-.3.1-.3.3v13.1c0 .1.1.3.3.3h5.1c.1 0 .3-.1.3-.3V10.7c0-.1-.1-.3-.3-.3zm16.1 6.8c0 3.8-3.2 7.1-7.7 7.1-4.4 0-7.6-3.3-7.6-7.1s3.2-7.1 7.7-7.1c4.4 0 7.6 3.3 7.6 7.1zm-5.4.1c0-1.4-1-2.5-2.2-2.4-1.3 0-2.2 1.1-2.2 2.4s1 2.4 2.2 2.4c1.3 0 2.2-1.1 2.2-2.4z\"\n});\n\nvar SvgTwilioLogo = function SvgTwilioLogo(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    fill: \"#F22F46\",\n    viewBox: \"0 0 100 30\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgTwilioLogo, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/twilio-logo.62d2e629.svg\";\nexport { ForwardRef as ReactComponent };","import React, { ChangeEvent, useState, FormEvent } from 'react';\r\nimport { useAppState } from '../../state';\r\n\r\nimport Button from '@material-ui/core/Button';\r\nimport ErrorOutlineIcon from '@material-ui/icons/ErrorOutline';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport Paper from '@material-ui/core/Paper';\r\nimport { ReactComponent as GoogleLogo } from './google-logo.svg';\r\nimport { ReactComponent as TwilioLogo } from './twilio-logo.svg';\r\nimport TextField from '@material-ui/core/TextField';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport videoLogo from './video-logo.png';\r\n\r\nimport { createMuiTheme, ThemeProvider } from '@material-ui/core/styles';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport { useLocation, useHistory } from 'react-router-dom';\r\n\r\nconst useStyles = makeStyles({\r\n  container: {\r\n    height: '100vh',\r\n    background: '#0D122B',\r\n  },\r\n  twilioLogo: {\r\n    width: '55%',\r\n    display: 'block',\r\n  },\r\n  videoLogo: {\r\n    width: '25%',\r\n    padding: '2.4em 0 2.1em',\r\n  },\r\n  paper: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    flexDirection: 'column',\r\n    maxWidth: '460px',\r\n    padding: '2em',\r\n    marginTop: '4em',\r\n    background: 'white',\r\n    color: 'black',\r\n  },\r\n  button: {\r\n    color: 'black',\r\n    background: 'white',\r\n    margin: '0.8em 0 0.7em',\r\n    textTransform: 'none',\r\n  },\r\n  errorMessage: {\r\n    color: 'red',\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    margin: '1em 0 0.2em',\r\n    '& svg': {\r\n      marginRight: '0.4em',\r\n    },\r\n  },\r\n});\r\n\r\nconst theme = createMuiTheme({\r\n  palette: {\r\n    type: 'light',\r\n  },\r\n});\r\n\r\nexport default function LoginPage() {\r\n  const classes = useStyles();\r\n  const { signIn, user, isAuthReady } = useAppState();\r\n  const history = useHistory();\r\n  const location = useLocation<{ from: Location }>();\r\n  const [passcode, setPasscode] = useState('');\r\n  const [authError, setAuthError] = useState<Error | null>(null);\r\n\r\n  const isAuthEnabled = Boolean(process.env.REACT_APP_SET_AUTH);\r\n\r\n  const login = () => {\r\n    setAuthError(null);\r\n    signIn?.(passcode)\r\n      .then(() => {\r\n        history.replace(location?.state?.from || { pathname: '/' });\r\n      })\r\n      .catch(err => setAuthError(err));\r\n  };\r\n\r\n  const handleSubmit = (e: FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault();\r\n    login();\r\n  };\r\n\r\n  if (user || !isAuthEnabled) {\r\n    history.replace('/');\r\n  }\r\n\r\n  if (!isAuthReady) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <Grid container justify=\"center\" alignItems=\"flex-start\" className={classes.container}>\r\n        <Paper className={classes.paper} elevation={6}>\r\n          <TwilioLogo className={classes.twilioLogo} />\r\n          <img className={classes.videoLogo} src={videoLogo} alt=\"Video Logo\"></img>\r\n\r\n          {process.env.REACT_APP_SET_AUTH === 'firebase' && (\r\n            <Button variant=\"contained\" className={classes.button} onClick={login} startIcon={<GoogleLogo />}>\r\n              Sign in with Google\r\n            </Button>\r\n          )}\r\n\r\n          {process.env.REACT_APP_SET_AUTH === 'passcode' && (\r\n            <form onSubmit={handleSubmit}>\r\n              <Grid container alignItems=\"center\" direction=\"column\">\r\n                <TextField\r\n                  id=\"input-passcode\"\r\n                  label=\"Passcode\"\r\n                  onChange={(e: ChangeEvent<HTMLInputElement>) => setPasscode(e.target.value)}\r\n                  type=\"password\"\r\n                />\r\n                <div>\r\n                  {authError && (\r\n                    <Typography variant=\"caption\" className={classes.errorMessage}>\r\n                      <ErrorOutlineIcon />\r\n                      {authError.message}\r\n                    </Typography>\r\n                  )}\r\n                </div>\r\n                <Button variant=\"contained\" className={classes.button} type=\"submit\" disabled={!passcode.length}>\r\n                  Submit\r\n                </Button>\r\n              </Grid>\r\n            </form>\r\n          )}\r\n        </Paper>\r\n      </Grid>\r\n    </ThemeProvider>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Redirect, Route, RouteProps } from 'react-router-dom';\r\nimport { useAppState } from '../../state';\r\n\r\nexport default function PrivateRoute({ children, ...rest }: RouteProps) {\r\n  const { isAuthReady, user } = useAppState();\r\n    \r\n  const renderChildren = user || !process.env.REACT_APP_SET_AUTH;\r\n\r\n  if (!renderChildren && !isAuthReady) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <Route\r\n      {...rest}\r\n      render={({ location }) =>\r\n        renderChildren ? (\r\n          children\r\n        ) : (\r\n          <Redirect\r\n            to={{\r\n              pathname: '/login',\r\n              state: { from: location },\r\n            }}\r\n          />\r\n        )\r\n      }\r\n    />\r\n  );\r\n}\r\n","import { createMuiTheme } from '@material-ui/core';\r\n\r\ndeclare module '@material-ui/core/styles/createMuiTheme' {\r\n  interface Theme {\r\n    sidebarWidth: number;\r\n    sidebarMobileHeight: number;\r\n  }\r\n\r\n  // allow configuration using `createMuiTheme`\r\n  interface ThemeOptions {\r\n    sidebarWidth?: number;\r\n    sidebarMobileHeight?: number;\r\n  }\r\n}\r\n\r\nexport default createMuiTheme({\r\n  palette: {\r\n    type: 'dark',\r\n    primary: {\r\n      main: '#F22F46',\r\n    },\r\n  },\r\n  sidebarWidth: 260,\r\n  sidebarMobileHeight: 90,\r\n});\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\nimport { CssBaseline } from '@material-ui/core';\r\nimport { MuiThemeProvider } from '@material-ui/core/styles';\r\n\r\nimport App from './App';\r\nimport AppStateProvider, { useAppState } from './state';\r\nimport { BrowserRouter as Router, Redirect, Route, Switch } from 'react-router-dom';\r\nimport { ConnectOptions } from 'twilio-video';\r\nimport ErrorDialog from './components/ErrorDialog/ErrorDialog';\r\nimport { isMobile } from './utils';\r\nimport LoginPage from './components/LoginPage/LoginPage';\r\nimport PrivateRoute from './components/PrivateRoute/PrivateRoute';\r\nimport theme from './theme';\r\nimport './types';\r\nimport { VideoProvider } from './components/VideoProvider';\r\n\r\n// See: https://media.twiliocdn.com/sdk/js/video/releases/2.0.0/docs/global.html#ConnectOptions\r\n// for available connection options.\r\nconst connectionOptions: ConnectOptions = {\r\n  // Bandwidth Profile, Dominant Speaker, and Network Quality\r\n  // features are only available in Small Group or Group Rooms.\r\n  // Please set \"Room Type\" to \"Group\" or \"Small Group\" in your\r\n  // Twilio Console: https://www.twilio.com/console/video/configure\r\n  bandwidthProfile: {\r\n    video: {\r\n      mode: 'collaboration',\r\n      dominantSpeakerPriority: 'standard',\r\n      renderDimensions: {\r\n        high: { height: 1080, width: 1920 },\r\n        standard: { height: 720, width: 1280 },\r\n        low: { height: 90, width: 160 },\r\n      },\r\n    },\r\n  },\r\n  dominantSpeaker: true,\r\n  networkQuality: { local: 1, remote: 1 },\r\n\r\n  // Comment this line if you are playing music.\r\n  maxAudioBitrate: 16000,\r\n\r\n  // VP8 simulcast enables the media server in a Small Group or Group Room\r\n  // to adapt your encoded video quality for each RemoteParticipant based on\r\n  // their individual bandwidth constraints. This has no effect if you are\r\n  // using Peer-to-Peer Rooms.\r\n  preferredVideoCodecs: [{ codec: 'VP8', simulcast: true }],\r\n};\r\n\r\n// For mobile browsers, limit the maximum incoming video bitrate to 2.5 Mbps.\r\nif (isMobile && connectionOptions?.bandwidthProfile?.video) {\r\n  connectionOptions!.bandwidthProfile!.video!.maxSubscriptionBitrate = 2500000;\r\n}\r\n\r\nconst VideoApp = () => {\r\n  const { error, setError } = useAppState();\r\n\r\n  return (\r\n    <VideoProvider options={connectionOptions} onError={setError}>\r\n      <ErrorDialog dismissError={() => setError(null)} error={error} />\r\n      <App />\r\n    </VideoProvider>\r\n  );\r\n};\r\n\r\nReactDOM.render(\r\n  <MuiThemeProvider theme={theme}>\r\n    <CssBaseline />\r\n    <Router>\r\n      <AppStateProvider>\r\n        <Switch>\r\n          <PrivateRoute exact path=\"/\">\r\n            <VideoApp />\r\n          </PrivateRoute>\r\n          <PrivateRoute path=\"/room/:URLRoomName\">\r\n            <VideoApp />\r\n          </PrivateRoute>\r\n          <Route path=\"/login\">\r\n            <LoginPage />\r\n          </Route>\r\n          <Redirect to=\"/\" />\r\n        </Switch>\r\n      </AppStateProvider>\r\n    </Router>\r\n  </MuiThemeProvider>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}